<!doctype html>
<html lang=zh-CN>
<head>
<meta charset=UTF-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>英语阅读单排版工具</title>
<style>body{margin:0;padding:0;background:#f5f5f5;font-family:"Microsoft YaHei",Arial,sans-serif}.container{display:flex;justify-content:center;align-items:flex-start;min-height:100vh;position:relative}#a4-area{width:210mm;height:auto;min-height:297mm;background:#fff;display:flex;flex-direction:column;margin-top:40px;margin-bottom:40px;margin-left:0;margin-right:0;transition:margin .3s,background .3s;line-height:2;border-radius:16px;background-size:cover;background-position:center;background-repeat:no-repeat}.title-area{width:100%;text-align:center;border-bottom:1px solid #e0e0e0;box-sizing:border-box}.book-header{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:24px 24px 12px 0;margin-left:0;margin-right:0}.book-header-left{display:flex;align-items:center;gap:24px;margin-left:32px}.book-icon{min-width:70px;min-height:70px;width:auto;height:auto;background:#1976d2!important;color:#fff!important;display:flex;flex-direction:column;align-items:center;justify-content:center;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.08);user-select:none;font-weight:700;padding:8px;font-size:unset;-webkit-print-color-adjust:exact;print-color-adjust:exact;position:relative}.book-icon .month{font-size:1.8em;line-height:1.1;text-align:center;max-width:100px;word-break:break-word}.book-icon .day{font-size:1.8em;line-height:1.1;margin-top:2px;text-align:center;max-width:100px;word-break:break-word}.book-titles{display:flex;flex-direction:column;align-items:flex-start}.main-title{font-weight:700;color:#111;line-height:1.3;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.sub-title{color:#c62828;font-weight:700;line-height:1.1}.reading-content{width:91%;margin:0 auto;flex:1 1 auto;height:auto;box-sizing:border-box;display:flex;flex-direction:row;position:relative;min-height:0}.content-left{flex:1 1 60%;min-width:120px;padding-right:16px;overflow:visible;display:flex;flex-direction:column;align-items:flex-start;min-height:0}.content-right{min-width:100px;max-width:100%;border-left:1px solid #d0d0d0;padding-left:16px;padding-right:16px;overflow:auto;min-height:0;box-sizing:border-box}.content-right::-webkit-scrollbar{display:none}#config-panel{width:320px;height:1120px;min-height:unset;max-height:unset;overflow-y:auto;background:#fafbfc;box-shadow:0 0 8px rgba(0,0,0,.08);margin-left:5px;margin-top:40px;padding:2px 16px 2px 16px;border-radius:16px;display:flex;flex-direction:column;gap:16px;transition:all .3s}#config-panel.hide{display:none}#hide-config{align-self:flex-end;margin-bottom:8px;background:#e0e0e0;border:none;border-radius:4px;padding:6px 12px;cursor:pointer}.toggle-btn{position:fixed;top:10px;right:10px;z-index:1000;background:#1976d2;color:#fff;border:none;border-radius:4px;padding:10px 18px;font-size:16px;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,.08);transition:background .2s}.toggle-btn:hover{background:#1565c0}.config-hidden #a4-area{margin-left:auto;margin-right:auto}ul#word-list{list-style:none;padding-left:0;line-height:1.2}.word-speaking{background:#bbdefb!important;transition:background .2s}.highlight-word{color:#d32f2f;font-weight:700}.word-row{display:block;padding:10px 10px 8px 10px;min-height:unset;border-bottom:1px solid #f0f0f0;border-radius:8px;margin-bottom:5px;box-shadow:0 1px 2px rgba(0,0,0,.02);transition:background .2s;overflow-wrap:break-word;word-break:break-all}.word-row-bottom,.word-row-top{display:flex;flex-direction:row;align-items:center;gap:6px;justify-content:flex-start}.word-row-top{display:flex;flex-direction:row;align-items:center;gap:6px;justify-content:flex-start;flex-wrap:wrap}.word-en{font-weight:700;font-size:1.18em;color:#222;letter-spacing:.5px}.word-phonetic{color:#8a8a8a;word-break:break-all;overflow:hidden;text-overflow:ellipsis;white-space:pre-line}.word-property{font-size:.98em;color:#b0b0b0;font-weight:400;margin-right:4px}.word-meaning{color:#888;font-size:.98em;font-weight:400;flex:2 1 0}.property-noun{color:#1976d2}.property-verb{color:#388e3c}.property-adj{color:#d32f2f}.property-adv{color:#f57c00}.property-prep{color:#6d4c41}.property-conj{color:#8e24aa}.property-pron{color:#00838f}.property-art{color:#c2185b}.property-num{color:#455a64}input[type=text],select,textarea{border-radius:10px!important;border:1px solid #d0d0d0;padding:6px 10px;font-size:16px;box-sizing:border-box;outline:0;transition:border-color .2s}input[type=text]:focus,select:focus,textarea:focus{border-color:#1976d2}#hide-config,.toggle-btn,button{border-radius:8px!important}#image-upload-area{border-radius:12px!important}#image-text-content{line-height:2.2}.highlight-word.property-noun,.word-row.property-noun{background:#e3f2fd!important}.highlight-word.property-verb,.word-row.property-verb{background:#e8f5e9!important}.highlight-word.property-adj,.word-row.property-adj{background:#ffebee!important}.highlight-word.property-adv,.word-row.property-adv{background:#fff3e0!important}.highlight-word.property-prep,.word-row.property-prep{background:#efebe9!important}.highlight-word.property-conj,.word-row.property-conj{background:#f3e5f5!important}.highlight-word.property-pron,.word-row.property-pron{background:#e0f7fa!important}.highlight-word.property-art,.word-row.property-art{background:#fce4ec!important}.highlight-word.property-num,.word-row.property-num{background:#eceff1!important}.word-row.special-case{background:#ffebee!important;border:1px solid rgba(211,47,47,.3)!important}.word-row.special-case .word-en{color:#d32f2f!important}.highlight-word{border-radius:6px;padding:0 4px;transition:background .2s}.stat-area{display:flex;align-items:center;gap:8px;flex-shrink:0;margin-right:0;max-width:160px;box-sizing:border-box}.stat-block{display:flex;flex-direction:column;align-items:center;min-width:50px}.stat-title{font-size:.18em;color:#888;padding-bottom:5px;margin-bottom:-50px;font-weight:500}.stat-circle{width:33px;height:33px;border-radius:20%;background:#e3f2fd;display:flex;align-items:center;justify-content:center;margin:0 auto;box-shadow:0 1px 4px rgba(25,118,210,.08)}.stat-words{background:#e3f2fd}.stat-keywords{background:#ffebee}.stat-num{font-size:1.3em;color:#1976d2;font-weight:700}.stat-keywords .stat-num{color:#d32f2f}.text-justify{text-align:justify!important;text-justify:inter-word;text-align-last:left!important}.text-justify .article-word-container{max-width:fit-content}@media print{.bg-colored .article-word-en{-webkit-print-color-adjust:exact;print-color-adjust:exact}.book-header,.title-area{margin-top:-20px!important;padding-top:10px!important}#toggle-config{display:none!important}.highlight-word.property-noun,.word-row.property-noun{background:#e3f2fd!important;-webkit-print-color-adjust:exact;print-color-adjust:exact}.highlight-word.property-verb,.word-row.property-verb{background:#e8f5e9!important;-webkit-print-color-adjust:exact;print-color-adjust:exact}.highlight-word.property-adj,.word-row.property-adj{background:#ffebee!important;-webkit-print-color-adjust:exact;print-color-adjust:exact}.highlight-word.property-adv,.word-row.property-adv{background:#fff3e0!important;-webkit-print-color-adjust:exact;print-color-adjust:exact}.highlight-word.property-prep,.word-row.property-prep{background:#efebe9!important;-webkit-print-color-adjust:exact;print-color-adjust:exact}.highlight-word.property-conj,.word-row.property-conj{background:#f3e5f5!important;-webkit-print-color-adjust:exact;print-color-adjust:exact}.highlight-word.property-pron,.word-row.property-pron{background:#e0f7fa!important;-webkit-print-color-adjust:exact;print-color-adjust:exact}.highlight-word.property-art,.word-row.property-art{background:#fce4ec!important;-webkit-print-color-adjust:exact;print-color-adjust:exact}.highlight-word.property-num,.word-row.property-num{background:#eceff1!important;-webkit-print-color-adjust:exact;print-color-adjust:exact}.word-row.special-case{background:#ffebee!important;border:1px solid rgba(211,47,47,.3)!important;-webkit-print-color-adjust:exact;print-color-adjust:exact}.word-row.special-case .word-en{color:#d32f2f!important;-webkit-print-color-adjust:exact;print-color-adjust:exact}.highlight-word{border-radius:6px;padding:0 4px;transition:none;-webkit-print-color-adjust:exact;print-color-adjust:exact}.book-icon{background:#1976d2!important;color:#fff!important;-webkit-print-color-adjust:exact;print-color-adjust:exact}.stat-circle.stat-words{background:#e3f2fd!important;color:#1976d2!important;-webkit-print-color-adjust:exact;print-color-adjust:exact}.stat-circle.stat-keywords{background:#ffebee!important;color:#d32f2f!important;-webkit-print-color-adjust:exact;print-color-adjust:exact}}.tts-underline{text-decoration:none;background:0 0!important;border-radius:0!important}.article-word-container.tts-underline .article-word-en{text-decoration:underline #1976d2 3px;text-underline-offset:10px;background:#ffe066!important;border-radius:0!important}.tts-underline-space{letter-spacing:0;text-decoration:underline #1976d2 3px;text-underline-offset:2px}label[for=tts-rate],label[for=tts-voice-select]{white-space:nowrap;display:inline-block;vertical-align:middle}.article-word-container{display:inline-flex;flex-direction:column;align-items:center;min-width:unset;min-height:unset;width:auto;height:auto;margin:4px 4px;padding:6px 6px 6px 6px;border-radius:10px;background:0 0;box-shadow:none!important;transition:background .2s,box-shadow .2s;position:relative;border:none!important}.article-word-container:hover{background:0 0;box-shadow:none!important;border:none!important}.article-word-phonetic{font-size:.85em;color:#222!important;margin-bottom:2px;line-height:1.2;font-style:italic}.article-word-en{color:#222;line-height:1.2}.article-word-meaning{font-size:.92em;color:#d32f2f;margin-top:2px;line-height:1.2;word-break:break-all}.article-word-punctuation{min-width:unset!important;min-height:unset!important;width:auto!important;height:auto!important;box-shadow:none!important;padding:2px 0 2px 0!important;background:0 0!important;border:none!important}.hide-phonetic .article-word-phonetic{display:none!important}.hide-meaning .article-word-meaning{display:none!important}.article-word-en.highlight-word.property-noun{color:#1976d2!important}.article-word-en.highlight-word.property-verb{color:#388e3c!important}.article-word-en.highlight-word.property-adj{color:#d32f2f!important}.article-word-en.highlight-word.property-adv{color:#f57c00!important}.article-word-en.highlight-word.property-prep{color:#6d4c41!important}.article-word-en.highlight-word.property-conj{color:#8e24aa!important}.article-word-en.highlight-word.property-pron{color:#00838f!important}.article-word-en.highlight-word.property-art{color:#c2185b!important}.article-word-en.highlight-word.property-num{color:#455a64!important}.article-word-container.article-word-punctuation{padding:8px 1px!important}.resizer{width:3px;min-width:3px;background:0 0;cursor:ew-resize;transition:background .2s;z-index:2}.resizer.active,.resizer:hover{background:#1976d2;box-shadow:0 0 4px #1976d2}.reading-content{position:relative}.hide-word-phonetic .word-phonetic{display:none!important}#toggle-config{opacity:0;pointer-events:none;transition:opacity .3s}#toggle-config.visible{opacity:1;pointer-events:auto}.resizable-image-container{display:inline-block;position:relative;max-width:100%}.resizable-image{display:block;max-width:100%;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.06)}.resize-handle{position:absolute;width:16px;height:16px;right:4px;bottom:4px;background:rgba(25,118,210,.7);border-radius:4px;cursor:se-resize;z-index:20;display:none;align-items:flex-end;justify-content:flex-end}.resizable-image-container:hover .resize-handle{display:flex}.resize-handle:after{content:"";display:block;width:12px;height:12px;border-right:2px solid #fff;border-bottom:2px solid #fff;margin:2px}.video-container{position:relative;width:100%;margin:16px 0;border-radius:12px;overflow:hidden;max-height:50vh;position:sticky;top:0;z-index:10;background:#fff;padding-bottom:10px}#main-video{display:block;width:100%;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.06)}.article-word-container.tts-underline .article-word-en{text-decoration:underline #ff5722 3px!important;text-underline-offset:10px!important;background:#ffe066!important;border-radius:0!important;font-weight:700!important;color:#d32f2f!important;transition:all .2s ease-in-out}#subtitle-upload-area{transition:all .3s ease}#subtitle-upload-area:hover{background:#c8e6c9!important;border-color:#2e7d32!important}#video-upload-area{transition:all .3s ease}#video-upload-area:hover{background:#bbdefb!important;border-color:#1565c0!important}#image-text-content .text-justify{text-align:justify!important;text-align-last:left!important}.custom-flex-container{justify-content:space-between}.custom-flex-container::after{content:"";flex:auto}.custom-flex-container>:last-child:not(:first-child):not(:nth-child(2)):not(:nth-child(3)){margin-right:auto!important}.color-option{transition:transform .2s,box-shadow .2s;border:2px solid transparent}.color-option:hover{transform:scale(1.1);box-shadow:0 2px 8px rgba(0,0,0,.2)}.color-option.selected{border:2px solid #fff;box-shadow:0 0 0 1px #000}.article-word-container.color-brush-hover{box-shadow:0 0 0 2px currentColor!important}#color-palette{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}.bg-color-option{transition:transform .2s,box-shadow .2s;border:2px solid transparent;position:relative}.bg-color-option:hover{transform:scale(1.1);box-shadow:0 2px 8px rgba(0,0,0,.2)}.bg-color-option.selected{border:2px solid #fff;box-shadow:0 0 0 1px #000}.bg-color-option::after{content:"Aa";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#000;font-size:14px;font-weight:700}</style>
</head>
<body>
<div class=container>
<div id=a4-area>
<div class=title-area>
<div class=book-header>
<div class=book-header-left>
<div class=book-icon>
<span class=month tabindex=0 style=cursor:pointer></span><span class=day tabindex=0 style=cursor:pointer></span>
<input id=month-input style="display:none;width:80px;height:32px;font-size:1.1em;text-align:center;border-radius:6px;border:none;outline:2px solid #1976d2;position:absolute;top:10px;left:10px;z-index:10">
<input id=day-input style="display:none;width:80px;height:32px;font-size:1.1em;text-align:center;border-radius:6px;border:none;outline:2px solid #1976d2;position:absolute;top:40px;left:10px;z-index:10">
</div>
<div class=book-titles>
<div class=main-title>请输入主标题</div>
<div class=sub-title>请输入副标题</div>
</div>
</div>
<div class=stat-area>
<div class=stat-block>
<div class="stat-circle stat-words">
<span class=stat-num id=total-words>0</span>
</div>
<div class=stat-title>总单词数</div>
</div>
<div class=stat-block>
<div class="stat-circle stat-keywords">
<span class=stat-num id=total-keywords>0</span>
</div>
<div class=stat-title>重点词汇</div>
</div>
</div>
</div>
</div>
<div class=reading-content>
<div class=content-left>
<div id=image-container></div>
<div id=image-text-content></div>
<div id=translation-content style=margin-top:12px;color:#444;font-size:16px></div>
</div>
<div class=resizer id=content-resizer></div>
<div class=content-right>
<ul id=word-list>
</ul>
</div>
</div>
</div>
<div id=config-panel class=show>
<button id=about-btn type=button style=flex:1;background:#ffa726;color:#fff>
关于/永久免费更新
</button>
<div id=tts-player style="margin:3px 0;padding:1px;background:#d2e4ff;border-radius:10px;box-shadow:0 1px 4px rgba(25,118,210,.06);display:flex;flex-direction:column;gap:1px;width:100%">
<div style=display:flex;align-items:center;gap:12px;width:100%;justify-content:center>
<button id=tts-prev-btn style=background:#e0e0e0;color:#333>
上一句
</button>
<button id=tts-toggle-btn style=background:#1976d2;color:#fff>
开始
</button>
<button id=tts-next-btn style=background:#e0e0e0;color:#333>
下一句
</button>
<span id=tts-current-sentence style=color:#1976d2;font-weight:700></span>
</div>
<div style=display:flex;align-items:center;gap:12px>
<input id=tts-progress type=range min=0 max=0 value=0 style=flex:1>
<span id=tts-progress-label style=min-width:60px>0/0</span>
</div>
<div style=display:flex;align-items:center;gap:16px>
<label for=tts-rate>语速</label>
<input id=tts-rate type=range min=0.5 max=2 step=0.1 value=1 style=width:120px>
<span id=tts-rate-label>1.00</span>
</div>
<div style=display:flex;align-items:center;gap:16px>
<label for=tts-voice-select>音色</label>
<select id=tts-voice-select style=min-width:180px></select>
</div>
</div>
<div style=display:flex;align-items:center;gap:16px>
<button id=toggle-phonetic-btn type=button style=flex:1;background:#1976d2;color:#fff>
隐藏音标
</button>
<button id=toggle-meaning-btn type=button style=flex:1;background:#d32f2f;color:#fff>
隐藏中文
</button>
</div>
<div style=display:flex;align-items:center;gap:16px;margin-top:4px>
<button id=toggle-keyword-meaning-in-article-btn type=button style=flex:1;background:#388e3c;color:#fff>
隐藏正文重点词中文
</button>
</div>
<div style=margin-top:2px;display:flex;gap:12px;align-items:center>
<button id=export-config type=button style=flex:1;background:#1976d2;color:#fff>
导出配置
</button>
<input id=import-config-file type=file accept=application/json style=display:none>
<button id=import-config-btn type=button style=flex:1;background:#1976d2;color:#fff>
拖入/导入配置
</button>
</div>
<div style=margin-top:1px;display:flex;gap:12px;align-items:center>
<button id=export-pdf type=button style=flex:1;background:#388e3c;color:#fff>
导出PDF
</button>
</div>
<div style=margin-bottom:2px>
<label for=one-paste-input><strong>一键自动解析</strong><button id=show-hint-btn type=button style=margin-top:8px;background:#1976d2;color:#fff>
点击查看内容生成提示词
</button></label>
<textarea id=one-paste-input rows=5 style=width:100%;margin-top:6px placeholder=此处填固定格式文本,格式获取点击上方按钮></textarea>
</div>
<div style=margin-top:8px;margin-bottom:8px;display:flex;gap:8px>
<button id=toggle-date-btn type=button>隐藏日期</button>
<button id=toggle-stats-btn type=button>隐藏统计信息</button>
<button id=toggle-wordlist-btn type=button style="color:#d32f2f;border:2px solid #d32f2f">隐藏单词区</button>
</div>
<div style=margin-top:12px;margin-bottom:8px;display:none>
<h4 style=margin-top:0;margin-bottom:8px>背景设置</h4>
<div style=margin-top:8px;margin-bottom:8px;display:flex;gap:8px;align-items:center>
<label style=min-width:90px>背景颜色</label>
<input type=color id=a4-bg-color-input value=#ffffff style=width:40px;height:32px;cursor:pointer>
<button id=reset-bg-color-btn type=button style=background:#e0e0e0;color:#333>重置</button>
</div>
<div style=margin-top:8px;margin-bottom:8px>
<label style=display:block;margin-bottom:6px>背景条纹</label>
<div style=display:flex;flex-wrap:wrap;gap:8px>
<button class=stripe-pattern-btn data-pattern=none style="width:40px;height:40px;background:#fff;border:1px solid #ccc">无</button>
<button class=stripe-pattern-btn data-pattern=horizontal style="width:40px;height:40px;background:repeating-linear-gradient(0deg,#f5f5f5,#f5f5f5 10px,#fff 10px,#fff 20px)"></button>
<button class=stripe-pattern-btn data-pattern=vertical style="width:40px;height:40px;background:repeating-linear-gradient(90deg,#f5f5f5,#f5f5f5 10px,#fff 10px,#fff 20px)"></button>
<button class=stripe-pattern-btn data-pattern=diagonal style="width:40px;height:40px;background:repeating-linear-gradient(45deg,#f5f5f5,#f5f5f5 10px,#fff 10px,#fff 20px)"></button>
<button class=stripe-pattern-btn data-pattern=diagonal-reverse style="width:40px;height:40px;background:repeating-linear-gradient(-45deg,#f5f5f5,#f5f5f5 10px,#fff 10px,#fff 20px)"></button>
<button class=stripe-pattern-btn data-pattern=cross style="width:40px;height:40px;background:repeating-linear-gradient(0deg,transparent,transparent 9px,#f5f5f5 9px,#f5f5f5 10px),repeating-linear-gradient(90deg,transparent,transparent 9px,#f5f5f5 9px,#f5f5f5 10px)"></button>
<button class=stripe-pattern-btn data-pattern=diagonal-cross style="width:40px;height:40px;background:repeating-linear-gradient(45deg,transparent,transparent 9px,#f5f5f5 9px,#f5f5f5 10px),repeating-linear-gradient(-45deg,transparent,transparent 9px,#f5f5f5 9px,#f5f5f5 10px)"></button>
<button class=stripe-pattern-btn data-pattern=zigzag style="width:40px;height:40px;background:linear-gradient(45deg,#f5f5f5 25%,transparent 25%) 0 0,linear-gradient(-45deg,#f5f5f5 25%,transparent 25%) 0 0,linear-gradient(45deg,transparent 75%,#f5f5f5 75%) 0 0,linear-gradient(-45deg,transparent 75%,#f5f5f5 75%) 0 0;background-size:20px 20px"></button>
</div>
<div style=margin-top:12px;display:flex;align-items:center;gap:8px>
<label style=min-width:90px>条纹间距</label>
<button id=stripe-gap-decrease type=button style=width:32px;height:32px;font-size:20px>-</button>
<span id=stripe-gap-display style=min-width:32px;text-align:center>10</span>
<button id=stripe-gap-increase type=button style=width:32px;height:32px;font-size:20px>+</button>
<span style=margin-left:4px>像素</span>
</div>
<div style=margin-top:8px;display:flex;align-items:center;gap:8px>
<label style=min-width:90px>条纹宽度</label>
<button id=stripe-width-decrease type=button style=width:32px;height:32px;font-size:20px>-</button>
<span id=stripe-width-display style=min-width:32px;text-align:center>10</span>
<button id=stripe-width-increase type=button style=width:32px;height:32px;font-size:20px>+</button>
<span style=margin-left:4px>像素</span>
</div>
<div style=margin-top:8px;display:flex;align-items:center;gap:8px>
<label style=min-width:90px>条纹角度</label>
<button id=stripe-angle-decrease type=button style=width:32px;height:32px;font-size:20px>-</button>
<span id=stripe-angle-display style=min-width:32px;text-align:center>45</span>
<button id=stripe-angle-increase type=button style=width:32px;height:32px;font-size:20px>+</button>
<span style=margin-left:4px>度</span>
</div>
<div style=margin-top:8px;display:flex;align-items:center;gap:8px>
<label style=min-width:90px>条纹颜色</label>
<input type=color id=stripe-color-input value=#f5f5f5 style=width:40px;height:32px;cursor:pointer>
<label style=margin-left:12px>透明度</label>
<input type=range id=stripe-opacity-slider min=0.1 max=1 step=0.1 value=1 style=width:100px>
<span id=stripe-opacity-value>1.0</span>
</div>
<div style=margin-top:8px;display:flex;align-items:center;gap:8px>
<label style=min-width:90px>条纹样式</label>
<select id=stripe-style-select style=height:32px>
<option value=solid>实线</option>
<option value=dashed>虚线</option>
<option value=dotted>点线</option>
</select>
<button id=apply-custom-stripe-btn type=button style=margin-left:12px;background:#1976d2;color:#fff>应用自定义</button>
</div>
</div>
<div style=margin-top:8px;margin-bottom:8px>
<label style=display:block;margin-bottom:6px>背景图片</label>
<div style=display:flex;gap:8px;align-items:center>
<button id=upload-bg-image-btn type=button style=background:#1976d2;color:#fff>上传图片</button>
<button id=remove-bg-image-btn type=button style=background:#e0e0e0;color:#333>移除图片</button>
<input type=file id=bg-image-input accept=image/* style=display:none>
</div>
<div style=margin-top:12px;display:flex;align-items:center;gap:8px>
<label style=min-width:90px>铺满方式</label>
<select id=bg-size-select style=height:32px;flex:1>
<option value=cover>铺满(cover)</option>
<option value=contain>包含(contain)</option>
<option value="100% 100%">拉伸(stretch)</option>
<option value=auto>原始大小(auto)</option>
</select>
</div>
<div style=margin-top:8px;display:flex;align-items:center;gap:8px>
<label style=min-width:90px>图片位置</label>
<select id=bg-position-select style=height:32px;flex:1>
<option value=center>居中(center)</option>
<option value=top>顶部(top)</option>
<option value=bottom>底部(bottom)</option>
<option value=left>左侧(left)</option>
<option value=right>右侧(right)</option>
<option value="top left">左上角(top left)</option>
<option value="top right">右上角(top right)</option>
<option value="bottom left">左下角(bottom left)</option>
<option value="bottom right">右下角(bottom right)</option>
</select>
</div>
<div style=margin-top:8px;display:flex;align-items:center;gap:8px>
<label style=min-width:90px>重复方式</label>
<select id=bg-repeat-select style=height:32px;flex:1>
<option value=no-repeat>不重复(no-repeat)</option>
<option value=repeat>重复平铺(repeat)</option>
<option value=repeat-x>水平重复(repeat-x)</option>
<option value=repeat-y>垂直重复(repeat-y)</option>
</select>
</div>
<button id=apply-bg-settings-btn type=button style=margin-top:12px;background:#1976d2;color:#fff;width:100%>应用背景设置</button>
</div>
</div>
<div style=margin-top:8px;margin-bottom:8px;display:flex;gap:8px;align-items:center>
<label style=min-width:90px>图标背景色</label>
<input type=color id=date-color-input value=#1976d2 style=width:40px;height:32px;cursor:pointer>
</div>
<div style=margin-top:8px;margin-bottom:8px;display:flex;gap:8px;align-items:center>
<label style=min-width:90px>图标文字色</label>
<input type=color id=date-text-color-input value=#ffffff style=width:40px;height:32px;cursor:pointer>
</div>
<div style=margin-top:8px;margin-bottom:8px;display:flex;gap:8px;align-items:center>
<label style=min-width:90px>图标圆角</label>
<button id=border-radius-decrease type=button style=width:32px;height:32px;font-size:20px>-</button>
<span id=border-radius-display style=min-width:32px;text-align:center>10</span>
<button id=border-radius-increase type=button style=width:32px;height:32px;font-size:20px>+</button>
</div>
<div style=margin-top:16px;margin-bottom:8px;padding:10px;background:#f5f5f5;border-radius:8px>
<h4 style=margin-top:0;margin-bottom:8px>词组容器样式设置</h4>
<div style=margin-top:8px;display:flex;align-items:center;gap:8px>
<label style=min-width:90px>背景颜色</label>
<input type=color id=special-case-bg-color value=#ffebee style=width:40px;height:32px;cursor:pointer>
<button id=reset-special-case-bg-btn type=button style=background:#e0e0e0;color:#333>重置</button>
</div>
<div style=margin-top:8px;display:flex;align-items:center;gap:8px>
<label style=min-width:90px>文字颜色</label>
<input type=color id=special-case-text-color value=#d32f2f style=width:40px;height:32px;cursor:pointer>
<button id=reset-special-case-text-btn type=button style=background:#e0e0e0;color:#333>重置</button>
</div>
<div style=margin-top:8px;display:flex;align-items:center;gap:8px>
<label style=min-width:90px>边框颜色</label>
<input type=color id=special-case-border-color value=#d32f2f style=width:40px;height:32px;cursor:pointer>
<input type=range id=special-case-border-opacity min=0.1 max=3 step=0.1 value=0.3 style=flex:1>
<span id=special-case-border-opacity-value>0.3</span>
</div>
<div style=margin-top:8px;font-size:.9em;color:#388e3c;text-align:center>
颜色设置已自动应用
</div>
</div>
<div style=margin-bottom:1px>
<label for=main-title-input><strong>主标题：</strong></label>
<input id=main-title-input style=width:100%;margin-top:1px;height:30px placeholder=如：滑雪场里的滑雪乐趣>
<div style=margin-top:4px>
<button id=main-title-font-size-decrease type=button>-</button>
<span id=main-title-font-size-display>32</span>
<button id=main-title-font-size-increase type=button>+</button>
</div>
</div>
<div style=margin-bottom:1px>
<label for=sub-title-input><strong>副标题：</strong></label>
<input id=sub-title-input style=width:100%;margin-top:6px;height:30px placeholder="如：Skiing Fun at the Ski Resort ">
<div style=margin-top:4px>
<button id=sub-title-font-size-decrease type=button>-</button>
<span id=sub-title-font-size-display>24</span>
<button id=sub-title-font-size-increase type=button>+</button>
</div>
</div>
<div id=image-upload-area style="border:2px dashed #1976d2;padding:24px;text-align:center;cursor:pointer;background:#f0f6ff;color:#1976d2;border-radius:8px;transition:border-color .2s">
<span>拖拽图片到此处，或点击上传</span>
<input type=file id=image-input accept=image/* style=display:none multiple>
</div>
<button id=clear-image-btn type=button style=background:#d32f2f;color:#fff>
清除图片
</button>
<div style=margin-top:1px>
<label for=words-input><strong>请输入重点单词（每行一个）：</strong></label>
<button id=toggle-word-phonetic-btn type=button style=margin-left:8px;background:#1976d2;color:#fff>隐藏重点单词音标</button>
<div style=display:flex;align-items:center;gap:8px;width:100%;margin-top:6px>
<textarea id=words-input rows=3 style=flex:1 placeholder="sit [sɪt] v. 坐
time [taɪm] n. 时间"></textarea>
<button id=word-font-size-decrease type=button style=width:32px;height:32px;font-size:20px>
-
</button>
<span id=word-font-size-display style=min-width:32px;text-align:center>16</span>
<button id=word-font-size-increase type=button style=width:32px;height:32px;font-size:20px>
+
</button>
</div>
</div>
<div style=margin-top:5px>
<label for=text-input><strong>请输入英语文章：</strong></label>
<textarea id=text-input rows=3 style=width:100%;margin-top:6px></textarea>
</div>
<div style=margin-top:1px>
<label for=font-select><strong>选择英文字体：</strong></label>
<div style=display:flex;align-items:center;gap:8px;width:100%;margin-top:6px> <button id=font-size-decrease type=button style=width:32px;height:32px;font-size:20px>
-
</button>
<span id=font-size-display style=min-width:32px;text-align:center>18</span>
<button id=font-size-increase type=button style=width:32px;height:32px;font-size:20px>
+
</button>
<select id=font-select style=flex:1;height:30px>
<option value="'Times New Roman', Times, serif">
Times New Roman
</option>
<option value="'Arial', sans-serif">Arial</option>
<option value="'Georgia', serif">Georgia</option>
<option value="'Verdana', sans-serif">Verdana</option>
<option value="'Courier New', Courier, monospace">
Courier New
</option>
<option value="'Trebuchet MS', sans-serif">Trebuchet MS</option>
<option value="'Comic Sans MS', cursive" selected>Comic Sans MS</option>
<option value="'Bradley Hand ITC', cursive">Bradley Hand ITC</option>
<option value="'Brush Script MT', cursive">Brush Script MT (意大利斜体)</option>
<option value="'Segoe Script', cursive">Segoe Script</option>
<option value="'Lucida Handwriting', cursive">Lucida Handwriting</option>
<option value="'Ink Free', cursive">Ink Free</option>
<option value="'Palatino', serif">Palatino</option>
<option value="'Bookman', serif">Bookman</option>
<option value="'Garamond', serif">Garamond</option>
<option value="'Baskervville', serif">Baskervville</option>
<option value="'Merriweather', serif">Merriweather</option>
</select>
</div>
<div style=display:flex;align-items:center;gap:8px;width:100%;margin-top:8px>
<label style=min-width:90px>英文行间距</label>
<button id=word-margin-vertical-decrease type=button style=width:32px;height:32px;font-size:20px>-</button>
<span id=word-margin-vertical-display style=min-width:32px;text-align:center>4</span>
<button id=word-margin-vertical-increase type=button style=width:32px;height:32px;font-size:20px>+</button>
</div>
<div style=display:flex;align-items:center;gap:8px;width:100%;margin-top:8px>
<label style=min-width:70px>英文字符间距</label>
<button id=letter-spacing-decrease type=button style=width:32px;height:32px;font-size:20px>
-
</button>
<span id=letter-spacing-display style=min-width:32px;text-align:center>-0.1</span>
<button id=letter-spacing-increase type=button style=width:32px;height:32px;font-size:20px>
+
</button>
</div>
<div style=display:flex;align-items:center;gap:8px;width:100%;margin-top:8px>
<label style=min-width:90px>英文单词块间距</label>
<button id=word-gap-decrease type=button style=width:32px;height:32px;font-size:20px>
-
</button>
<span id=word-gap-display style=min-width:32px;text-align:center>-4</span>
<button id=word-gap-increase type=button style=width:32px;height:32px;font-size:20px>
+
</button>
</div>
<div style=display:flex;align-items:center;gap:8px;width:100%;margin-top:8px>
<label style=min-width:90px>中文意思字号</label>
<button id=meaning-font-size-decrease type=button style=width:32px;height:32px;font-size:20px>
-
</button>
<span id=meaning-font-size-display style=min-width:32px;text-align:center>16</span>
<button id=meaning-font-size-increase type=button style=width:32px;height:32px;font-size:20px>
+
</button>
</div>
<div style=display:flex;align-items:center;gap:8px;width:100%;margin-top:8px>
<label style=min-width:90px>中文意思颜色</label>
<input id=meaning-color-input type=color value=#d32f2f style=width:40px;height:32px>
</div>
<div style=display:flex;align-items:center;gap:12px;width:100%;margin-top:8px></div>
</div>
<div style=margin-top:8px>
<label><strong>单词染色工具：</strong></label>
<div style=display:flex;flex-wrap:wrap;gap:8px;margin-top:6px>
<button id=toggle-color-brush-btn type=button style=flex:1;background:#1976d2;color:#fff>
启用染色模式
</button>
<button id=clear-all-colors-btn type=button style=flex:1;background:#d32f2f;color:#fff>
清除所有颜色
</button>
</div>
<div id=color-palette style=display:flex;flex-wrap:wrap;gap:8px;margin-top:8px>
<div class="color-option selected" data-color=#1976d2 style=background:#1976d2;width:32px;height:32px;border-radius:4px;cursor:pointer></div>
<div class=color-option data-color=#388e3c style=background:#388e3c;width:32px;height:32px;border-radius:4px;cursor:pointer></div>
<div class=color-option data-color=#d32f2f style=background:#d32f2f;width:32px;height:32px;border-radius:4px;cursor:pointer></div>
<div class=color-option data-color=#f57c00 style=background:#f57c00;width:32px;height:32px;border-radius:4px;cursor:pointer></div>
<div class=color-option data-color=#6d4c41 style=background:#6d4c41;width:32px;height:32px;border-radius:4px;cursor:pointer></div>
<div class=color-option data-color=#8e24aa style=background:#8e24aa;width:32px;height:32px;border-radius:4px;cursor:pointer></div>
<div class=color-option data-color=#00838f style=background:#00838f;width:32px;height:32px;border-radius:4px;cursor:pointer></div>
<div class=color-option data-color=#c2185b style=background:#c2185b;width:32px;height:32px;border-radius:4px;cursor:pointer></div>
<div class=color-option data-color=#455a64 style=background:#455a64;width:32px;height:32px;border-radius:4px;cursor:pointer></div>
</div>
<div style=margin-top:8px>
<label><strong>自定义颜色：</strong></label>
<div style=display:flex;flex-wrap:wrap;gap:8px;margin-top:6px>
<div class=custom-color-container style=display:flex;align-items:center;gap:4px>
<input type=color id=custom-color-1 value=#ff9800 style=width:24px;height:24px;padding:0;cursor:pointer>
<div class="color-option custom-color-option" data-color=#ff9800 data-custom-id=1 style=background:#ff9800;width:32px;height:32px;border-radius:4px;cursor:pointer></div>
</div>
<div class=custom-color-container style=display:flex;align-items:center;gap:4px>
<input type=color id=custom-color-2 value=#9c27b0 style=width:24px;height:24px;padding:0;cursor:pointer>
<div class="color-option custom-color-option" data-color=#9c27b0 data-custom-id=2 style=background:#9c27b0;width:32px;height:32px;border-radius:4px;cursor:pointer></div>
</div>
<div class=custom-color-container style=display:flex;align-items:center;gap:4px>
<input type=color id=custom-color-3 value=#009688 style=width:24px;height:24px;padding:0;cursor:pointer>
<div class="color-option custom-color-option" data-color=#009688 data-custom-id=3 style=background:#009688;width:32px;height:32px;border-radius:4px;cursor:pointer></div>
</div>
</div>
</div>
<div style=margin-top:16px>
<label><strong>单词背景染色：</strong></label>
<div style=display:flex;flex-wrap:wrap;gap:8px;margin-top:6px>
<button id=toggle-bg-color-brush-btn type=button style=flex:1;background:#1976d2;color:#fff>
启用背景染色
</button>
<button id=clear-all-bg-colors-btn type=button style=flex:1;background:#d32f2f;color:#fff>
清除所有背景
</button>
</div>
<div id=bg-color-palette style=display:flex;flex-wrap:wrap;gap:8px;margin-top:8px>
<div class="bg-color-option selected" data-color=#ffe066 style=background:#ffe066;width:32px;height:32px;border-radius:4px;cursor:pointer></div>
<div class=bg-color-option data-color=#c8e6c9 style=background:#c8e6c9;width:32px;height:32px;border-radius:4px;cursor:pointer></div>
<div class=bg-color-option data-color=#ffcdd2 style=background:#ffcdd2;width:32px;height:32px;border-radius:4px;cursor:pointer></div>
<div class=bg-color-option data-color=#bbdefb style=background:#bbdefb;width:32px;height:32px;border-radius:4px;cursor:pointer></div>
<div class=bg-color-option data-color=#d1c4e9 style=background:#d1c4e9;width:32px;height:32px;border-radius:4px;cursor:pointer></div>
<div class=bg-color-option data-color=#b2dfdb style=background:#b2dfdb;width:32px;height:32px;border-radius:4px;cursor:pointer></div>
<div class=bg-color-option data-color=#f8bbd0 style=background:#f8bbd0;width:32px;height:32px;border-radius:4px;cursor:pointer></div>
<div class=bg-color-option data-color=#fff9c4 style=background:#fff9c4;width:32px;height:32px;border-radius:4px;cursor:pointer></div>
<div class=bg-color-option data-color=#cfd8dc style=background:#cfd8dc;width:32px;height:32px;border-radius:4px;cursor:pointer></div>
</div>
<div style=margin-top:8px>
<label><strong>自定义背景颜色：</strong></label>
<div style=display:flex;flex-wrap:wrap;gap:8px;margin-top:6px>
<div class=custom-bg-color-container style=display:flex;align-items:center;gap:4px>
<input type=color id=custom-bg-color-1 value=#ffcc80 style=width:24px;height:24px;padding:0;cursor:pointer>
<div class="bg-color-option custom-bg-color-option" data-color=#ffcc80 data-custom-id=1 style=background:#ffcc80;width:32px;height:32px;border-radius:4px;cursor:pointer></div>
</div>
<div class=custom-bg-color-container style=display:flex;align-items:center;gap:4px>
<input type=color id=custom-bg-color-2 value=#e1bee7 style=width:24px;height:24px;padding:0;cursor:pointer>
<div class="bg-color-option custom-bg-color-option" data-color=#e1bee7 data-custom-id=2 style=background:#e1bee7;width:32px;height:32px;border-radius:4px;cursor:pointer></div>
</div>
<div class=custom-bg-color-container style=display:flex;align-items:center;gap:4px>
<input type=color id=custom-bg-color-3 value=#b2ebf2 style=width:24px;height:24px;padding:0;cursor:pointer>
<div class="bg-color-option custom-bg-color-option" data-color=#b2ebf2 data-custom-id=3 style=background:#b2ebf2;width:32px;height:32px;border-radius:4px;cursor:pointer></div>
</div>
</div>
</div>
</div>
</div>
<div style=margin-top:8px;margin-bottom:8px;display:flex;gap:8px;align-items:center>
<label style=min-width:90px>首行缩进</label>
<button id=indent-decrease type=button style=width:32px;height:32px;font-size:20px>-</button>
<span id=indent-display style=min-width:32px;text-align:center>2</span>
<button id=indent-increase type=button style=width:32px;height:32px;font-size:20px>+</button>
<button id=toggle-indent-btn type=button style=margin-left:8px;background:#1976d2;color:#fff>关闭缩进</button>
</div>
<div style=margin-top:5px>
<label for=translation-input><strong>请输入中文译文：</strong></label>
<textarea id=translation-input rows=4 style=width:100%;margin-top:6px></textarea>
</div>
<div style=margin-top:5px>
<label for=article-phonetic-input><strong>请输入文章音标（可选）：</strong></label>
<textarea id=article-phonetic-input rows=3 style=width:100%;margin-top:6px placeholder="[ˈnɒlɪdʒ]
[bʌt]
[ˈɔːlsəʊ]
[bɪld]"></textarea>
<div style=margin-top:10px;padding:10px;background:#f5f5f5;border-radius:8px>
<label><strong>音标样式自定义：</strong></label>
<button id=refresh-phonetic-styles style="margin-left:10px;padding:2px 8px;background:#f0f0f0;border:1px solid #ccc;border-radius:4px;cursor:pointer;display:none">刷新样式</button>
<div style=margin-top:8px;display:flex;align-items:center;gap:8px>
<label style=min-width:90px>包裹样式</label>
<select id=phonetic-wrapper-style style=height:32px>
<option value=brackets>[ ] 方括号</option>
<option value=slashes>/ / 斜杠</option>
<option value=none>无包裹</option>
</select>
</div>
<div style=margin-top:8px;display:flex;align-items:center;gap:8px>
<label style=min-width:90px>音标颜色</label>
<input type=color id=phonetic-color-input value=#8a8a8a style=width:40px;height:32px;cursor:pointer>
</div>
<div style=margin-top:8px;display:flex;align-items:center;gap:8px>
<label style=min-width:90px>字体样式</label>
<select id=phonetic-font-family style=height:32px>
<option value="'Times New Roman', Times, serif" selected>Times New Roman</option>
<option value="'Arial', sans-serif">Arial</option>
<option value="'Georgia', serif">Georgia</option>
<option value="'Courier New', Courier, monospace">Courier New</option>
<option value="'Lucida Sans Unicode', 'Lucida Grande', sans-serif">Lucida Sans Unicode</option>
<option value="'BasemicNeue', sans-serif">BasemicNeue</option>
</select>
</div>
<div style=margin-top:8px;display:flex;align-items:center;gap:8px>
<label style=min-width:90px>音标大小</label>
<button id=phonetic-size-decrease type=button style=width:32px;height:32px;font-size:20px>-</button>
<span id=phonetic-size-display style=min-width:32px;text-align:center>0.85</span>
<button id=phonetic-size-increase type=button style=width:32px;height:32px;font-size:20px>+</button>
<span>em</span>
</div>
<div style=margin-top:8px;display:flex;align-items:center;gap:8px;display:none>
<label style=min-width:90px>倾斜度</label>
<button id=phonetic-italic-toggle type=button style=flex:1;background:#1976d2;color:#fff>
开启倾斜
</button>
</div>
</div>
</div>
<div style=margin-top:5px>
<label for=article-meaning-input><strong>请输入每个单词的意思：</strong></label>
<textarea id=article-meaning-input rows=3 style=width:100%;margin-top:6px placeholder="知识
但是
也
建立"></textarea>
</div>
</div>
</div>
<button id=toggle-config class=toggle-btn>配置界面</button>
<div id=about-modal style=display:none;position:fixed;z-index:2000;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,.25);align-items:center;justify-content:center>
<div style="background:#fff;padding:32px 32px 24px 32px;border-radius:16px;box-shadow:0 4px 24px rgba(0,0,0,.18);min-width:320px;max-width:90vw;position:relative;display:flex;flex-direction:column;align-items:center">
<div style=font-size:1.5em;font-weight:700;margin-bottom:12px>
助力英语学习 做100款相关软件
</div>
<div style=font-size:1.1em;font-weight:700;margin-bottom:12px>
当前版本：2.6.0 2025年5月19日
</div>
<div style=font-size:1.1em;margin-bottom:18px>
作者微信：suixinyinyue正版持有者永久免费更新
</div>
<button id=close-about-modal style="margin-top:8px;background:#e0e0e0;color:#333;border:none;border-radius:6px;padding:8px 24px;font-size:1em;cursor:pointer">
关闭
</button>
</div>
</div>
<div id=hint-modal style=display:none;position:fixed;z-index:3000;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,.25);align-items:center;justify-content:center>
<div style="background:#fff;padding:32px 32px 24px 32px;border-radius:16px;box-shadow:0 4px 24px rgba(0,0,0,.18);min-width:220px;max-width:90vw;position:relative;display:flex;flex-direction:column;align-items:center">
<div id=hint-content style=font-size:1.2em;font-weight:700;margin-bottom:12px;white-space:pre-line>
根据图片生成一个初中生的英文文章(各种词性的词都要有)。 列出文章内容(只包含英文内容，不包含英标)，英文标题，中文标题，输出15个重点单词(各种词性的词都要有)(不要序号)。 输出格式总要求： 一、用英文冒号，不要要中文冒号。 二、格式输出: 主标题:+回车+内容xxx 副标题:+回车+内容xxx 重点单词:+回车+内容xxx 英文文章:+回车+内容xxx 中文译文:+回车+内容xxx 三、行前不要输出任何序号 重点单词格式输出要求： 一、包括：单词(不要词组) 美式音标(用[]包裹) 词性缩写 中文意思。 二、元素之间留一个空格符。
</div>
<div style=display:flex;gap:12px;width:100%;justify-content:flex-end>
<button id=copy-hint-btn style="background:#1976d2;color:#fff;border:none;border-radius:6px;padding:8px 24px;font-size:1em;cursor:pointer">
复制
</button>
<button id=close-hint-modal style="background:#e0e0e0;color:#333;border:none;border-radius:6px;padding:8px 24px;font-size:1em;cursor:pointer">
关闭
</button>
</div>
</div>
</div>
<script>document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("config-panel"),t=document.getElementById("toggle-config"),n=document.querySelector(".container");function o(){e.classList.remove("hide"),n.classList.remove("config-hidden")}t.addEventListener("click",(function(){e.classList.contains("hide")?o():(e.classList.add("hide"),n.classList.add("config-hidden"))})),o();const i=document.getElementById("image-upload-area"),c=document.getElementById("image-input"),l=(document.querySelector(".reading-content"),document.querySelector(".content-left"),document.getElementById("image-text-content")),d=document.getElementById("image-container"),r=document.getElementById("translation-content");function s(e){d.innerHTML="";const t=e[0];if(!t||!t.type.startsWith("image/"))return;const n=new FileReader;n.onload=function(e){const t=document.createElement("div");t.className="resizable-image-container main-image-container";const n=document.createElement("img");n.src=e.target.result,n.className="resizable-image",n.style.width="400px",n.style.height="auto",n.style.display="block",n.style.margin="16px 0",n.style.boxShadow="0 2px 8px rgba(0,0,0,0.06)",n.style.borderRadius="12px",t.appendChild(n);const o=document.createElement("div");o.className="resize-handle",t.appendChild(o),d.appendChild(t),Cn(t)},n.readAsDataURL(t)}i.addEventListener("click",(function(){c.click()})),i.addEventListener("dragover",(function(e){e.preventDefault(),i.style.borderColor="#1565c0"})),i.addEventListener("dragleave",(function(e){e.preventDefault(),i.style.borderColor="#1976d2"})),i.addEventListener("drop",(function(e){e.preventDefault(),i.style.borderColor="#1976d2",s(e.dataTransfer.files)})),c.addEventListener("change",(function(e){s(e.target.files),c.value=""}));const a=document.getElementById("text-input");let u=[];let m=!0;const g=document.getElementById("toggle-keyword-meaning-in-article-btn");function p(){g.textContent=m?"隐藏正文重点词中文":"显示正文重点词中文"}function w(){const e=a.value;if(!e)return void(l.innerHTML="");const t=(document.getElementById("article-phonetic-input").value||"").split("\n").map((e=>e.trim())),n=(document.getElementById("article-meaning-input").value||"").split("\n").map((e=>e.trim())),o=window.currentMeaningFontSize||16,i=window.currentMeaningColor||"#d32f2f",c=function(){const e={};return(y.value.split("\n")||[]).forEach((t=>{const n=t.match(/^([a-zA-Z\-']+)\s*\[[^\]]*\]\s*([a-zA-Z\.]+)\s+/);if(n){let t=n[2],o="";/^n\./i.test(t)?o="property-noun":/^v\./i.test(t)?o="property-verb":/^adj\./i.test(t)?o="property-adj":/^adv\./i.test(t)?o="property-adv":/^prep\./i.test(t)?o="property-prep":/^conj\./i.test(t)?o="property-conj":/^pron\./i.test(t)?o="property-pron":/^art\./i.test(t)?o="property-art":/^num\./i.test(t)&&(o="property-num"),e[n[1].toLowerCase()]=o}})),e}(),d=function(){const e={};return(y.value.split("\n")||[]).forEach((t=>{const n=t.match(/^([a-zA-Z\-']+)\s*\[([^\]]*)\]\s*[a-zA-Z\.]+\s+(.+)$/);n&&(e[n[1].toLowerCase()]={phonetic:n[2],meaning:n[3]})})),e}(),r=e.split("\n");let s="",u=0,g=0;for(let e=0;e<r.length;e++){let l=r[e];if(s+=window.renderImagesAt(e,!0),""===l.trim()){s+='<div style="height:1.5em"></div>',s+=window.renderImagesAt(e,!1),window.editImageMode&&(s+=`<button type="button" onclick="insertImageAt(${e}, false)" style="margin:4px 0 4px 0;">插入图片</button>`);continue}let a=F>=0;s+=`<div class="${window.textJustifyEnabled?"text-justify":""} custom-flex-container" style="display:flex;flex-wrap:wrap;${a?`gap:${F}px;`:""}width:100%;">`;const p=l.match(/[a-zA-Z0-9\-']+|[^\w\s]+|\s+/g)||[];let w=[];p.length>0&&window.indentEnabled&&w.push(`<div style="display:inline-block;width:${window.indentSize}em;height:1px;"></div>`);for(let e=0;e<p.length;e++){let l=p[e];if(/^\s+$/.test(l)){w.push('<span style="width:1px;display:inline-block;"></span>');continue}let r="",s="",y=!1,f="",h="";/^[a-zA-Z\-']+$/.test(l)?(r=t[u]||"",s=m&&d[l.toLowerCase()]&&d[l.toLowerCase()].meaning?d[l.toLowerCase()].meaning:n[u]||"",f=c[l.toLowerCase()]||"",h=`article-word-${g}`,u++,g++):/^[^a-zA-Z0-9\s]+$/.test(l)&&(y=!0);let v="";r&&(r=r.replace(/^\[|\]$|^\/|\/$|^$/g,"").trim(),v="brackets"===window.phoneticWrapperStyle?"["+r+"]":"slashes"===window.phoneticWrapperStyle?"/"+r+"/":r);const E=`font-size:${window.phoneticSize}em !important;color:${window.phoneticColor} !important;height:1.2em;font-family:${window.phoneticFontFamily} !important;font-style:${window.phoneticItalic?"italic":"normal"} !important;`;let b=a||e===p.length-1?"":`margin-right:${F}px;`,B=`margin-top:${j}px;margin-bottom:${j}px;`;if(y)w.push(`\n<div class="article-word-container article-word-punctuation" style="display:flex;flex-direction:column;align-items:center;${b}${B}">\n  <div class="article-word-phonetic" style="${E}"></div>\n  <div class="article-word-en">${l}</div>\n  <div class="article-word-meaning" style="font-size:${o}px;color:${i};height:1.2em;"></div>\n</div>\n`);else if(h){let e="article-word-container";f&&(e+=" "+f);let t="article-word-en";f&&(t+=" highlight-word "+f),w.push(`\n<div id="${h}" class="${e}" style="display:flex;flex-direction:column;align-items:center;${b}${B}">\n  <div class="article-word-phonetic" style="${E}">${v}</div>\n  <div class="${t}">${l}</div>\n  <div class="article-word-meaning" style="font-size:${o}px;color:${i};height:1.2em;">${s}</div>\n</div>\n`)}else{let e="article-word-container";f&&(e+=" "+f);let t="article-word-en";f&&(t+=" highlight-word "+f),w.push(`\n<div class="${e}" style="display:flex;flex-direction:column;align-items:center;${b}${B}">\n  <div class="article-word-phonetic" style="${E}">${v}</div>\n  <div class="${t}">${l}</div>\n  <div class="article-word-meaning" style="font-size:${o}px;color:${i};height:1.2em;">${s}</div>\n</div>\n`)}}s+=w.join(""),s+="</div>",s+=window.renderImagesAt(e,!1),window.editImageMode&&(s+=`<button type="button" onclick="insertImageAt(${e}, false)" style="margin:4px 0 4px 0;">插入图片</button>`)}l.innerHTML=s}g.addEventListener("click",(function(){m=!m,p(),w()})),p(),a.addEventListener("input",(function(){w()}));const y=document.getElementById("words-input"),f=document.getElementById("word-list");y.addEventListener("input",(function(){w()}));const h=document.getElementById("font-select");document.getElementById("image-text-content").style.fontFamily=h.value,h.addEventListener("change",(function(){document.getElementById("image-text-content").style.fontFamily=h.value}));const v=document.getElementById("font-size-display"),E=document.getElementById("font-size-increase"),b=document.getElementById("font-size-decrease");let B=18;function x(){document.getElementById("image-text-content").style.fontSize=B+"px",v.textContent=B}x(),E.addEventListener("click",(function(){B<36&&(B++,x())})),b.addEventListener("click",(function(){B>12&&(B--,x())}));const I=document.getElementById("letter-spacing-display"),C=document.getElementById("letter-spacing-increase"),L=document.getElementById("letter-spacing-decrease");let S=.5;function k(){document.getElementById("image-text-content").style.letterSpacing=S+"px",I.textContent=S}k(),C.addEventListener("click",(function(){S<5&&(S=Math.round(10*(S+.1))/10,k())})),L.addEventListener("click",(function(){S>-2&&(S=Math.round(10*(S-.1))/10,k())}));const $=document.getElementById("word-gap-display"),z=document.getElementById("word-gap-increase"),M=document.getElementById("word-gap-decrease");let F=-8;function A(){$.textContent=F,w()}z.addEventListener("click",(function(){F<40&&(F++,A())})),M.addEventListener("click",(function(){F>-40&&(F--,A())}));const T=document.getElementById("word-margin-vertical-display"),W=document.getElementById("word-margin-vertical-increase"),q=document.getElementById("word-margin-vertical-decrease");let j=4;function O(){T.textContent=j,localStorage.setItem("word-margin-vertical",j),w()}null!==localStorage.getItem("word-margin-vertical")&&(j=parseInt(localStorage.getItem("word-margin-vertical"),10)||0),W.addEventListener("click",(function(){j<40&&(j++,O())})),q.addEventListener("click",(function(){j>-20&&(j--,O())}));const H=document.getElementById("translation-input");H.addEventListener("input",(function(){const e=H.value.trim();r.innerHTML=e?e.split("\n").map((e=>e.trim()&&window.indentEnabled?`<p style="text-indent: ${window.indentSize}em;">${e}</p>`:`<p>${e}</p>`)).join(""):""}));const R=document.getElementById("word-font-size-display"),D=document.getElementById("word-font-size-increase"),V=document.getElementById("word-font-size-decrease");let N=16;function J(){f.style.fontSize=N+"px",R.textContent=N}J(),D.addEventListener("click",(function(){N<36&&(N++,J())})),V.addEventListener("click",(function(){N>1&&(N--,J())})),y.addEventListener("input",(function(){const e=y.value.split("\n");f.innerHTML="",u=e.map((e=>{const t=e.match(/^([a-zA-Z\-']+)\s*\[[^\]]*\]\s*([^\s]+\.)$/);let n="",o="",i="";return t&&(n=t[1],o=t[2],/^n\./i.test(o)?i="property-noun":/^v\./i.test(o)?i="property-verb":/^adj\./i.test(o)?i="property-adj":/^adv\./i.test(o)?i="property-adv":/^prep\./i.test(o)?i="property-prep":/^conj\./i.test(o)?i="property-conj":/^pron\./i.test(o)?i="property-pron":/^art\./i.test(o)?i="property-art":/^num\./i.test(o)&&(i="property-num")),n?{word:n,propertyClass:i}:null})).filter(Boolean);for(const t of e){if(""===t.trim()){const e=document.createElement("li");e.style.height="1.5em",e.style.background="none",e.style.border="none",f.appendChild(e);continue}const e=t.match(/^([^[\n]+)$/),n=e?null:t.match(/^([a-zA-Z\-']+)\s*\[([^\]]+)\]\s*([^\s]+\.)\s*(.+)$/);let o="",i="",c="",l="",d="";if(n)o=n[1],i=n[2],c=n[3],l=n[4],/^n\./i.test(c)?d="property-noun":/^v\./i.test(c)?d="property-verb":/^adj\./i.test(c)?d="property-adj":/^adv\./i.test(c)?d="property-adv":/^prep\./i.test(c)?d="property-prep":/^conj\./i.test(c)?d="property-conj":/^pron\./i.test(c)?d="property-pron":/^art\./i.test(c)?d="property-art":/^num\./i.test(c)&&(d="property-num");else{const e=t.match(/^([a-zA-Z\-']+)\s*\[([^\]]+)\]\s+(.+)$/);if(e)o=e[1],i=e[2],l=e[3],d="property-adj",c="adj.";else{const e=t.split(/\s+/);e.length>=2&&/^[a-zA-Z\-']+$/.test(e[0])?(o=e[0],l=e.slice(1).join(" "),d="property-adj",c="adj."):(l=t,d="property-adj",c="adj.")}}const r=document.createElement("li");r.className="word-row"+(d?" "+d:"");const s=t.match(/^name\s+is\s+[\u4e00-\u9fff]+$/i);if(null===n&&(s||e&&!o||t.match(/^.*[\u4e00-\u9fff]+.*$/))){r.className="word-row special-case";let e=t,n="";if(s){const o=t.match(/^(name\s+is)\s+([\u4e00-\u9fff]+)$/i);o&&(e=o[1].trim(),n=o[2].trim())}else{const o=/[\u4e00-\u9fff]/;if(o.test(t)){const i=t.match(/^(.*?)([\u4e00-\u9fff].*)$/);if(i)e=i[1].trim(),n=i[2].trim();else{let i=-1;for(let e=0;e<t.length;e++)if(o.test(t[e])&&e>0){i=e;break}i>0&&(e=t.substring(0,i).trim(),n=t.substring(i).trim())}}}r.innerHTML=`\n                <div class="word-row-top">\n                    <span class="word-en" title="${e}">${e}</span>\n                </div>\n                ${n?`<div class="word-row-bottom">\n                    <span class="word-meaning" title="${n}">${n}</span>\n                </div>`:""}\n              `}else r.innerHTML=`\n                  <div class="word-row-top">\n                      <span class="word-en ${d}" title="${o}">${o}</span>\n                      <span class="word-phonetic" title="${i}">${i?"["+i+"]":""}</span>\n                  </div>\n                  <div class="word-row-bottom">\n                      <span class="word-property ${d}" title="${c}">${c}</span>\n                      <span class="word-meaning" title="${l}">${l}</span>\n                  </div>\n              `;let a=o||t;r.style.cursor="pointer",r.title="点击朗读单词",r.addEventListener("click",(function(){document.querySelectorAll("#word-list li").forEach((e=>e.classList.remove("word-speaking"))),r.classList.add("word-speaking");const e=new window.SpeechSynthesisUtterance(a);e.lang="en-US",e.onend=function(){r.classList.remove("word-speaking")},window.speechSynthesis.speak(e)})),f.appendChild(r)}}));const P=document.getElementById("main-title-input"),Z=document.getElementById("sub-title-input"),U=document.querySelector(".main-title"),G=document.querySelector(".sub-title");P.addEventListener("input",(function(){U.textContent=P.value.trim()||"主标题"})),Z.addEventListener("input",(function(){G.textContent=Z.value.trim()||"副标题"}));let X=32;const _=document.getElementById("main-title-font-size-display"),Y=document.getElementById("main-title-font-size-increase"),K=document.getElementById("main-title-font-size-decrease");function Q(){document.querySelector(".main-title").style.fontSize=X+"px",_.textContent=X}Y.onclick=function(){X<80&&(X++,Q())},K.onclick=function(){X>12&&(X--,Q())},Q();let ee=24;const te=document.getElementById("sub-title-font-size-display"),ne=document.getElementById("sub-title-font-size-increase"),oe=document.getElementById("sub-title-font-size-decrease");function ie(){document.querySelector(".sub-title").style.fontSize=ee+"px",te.textContent=ee}ne.onclick=function(){ee<60&&(ee++,ie())},oe.onclick=function(){ee>10&&(ee--,ie())},ie();const ce=document.querySelector(".book-icon"),le=document.getElementById("toggle-date-btn");let de=!0;le.onclick=function(){de=!de,ce.style.display=de?"":"none",le.textContent=de?"隐藏日期":"显示日期"};const re=document.querySelectorAll(".stat-block")[0],se=document.querySelectorAll(".stat-block")[1],ae=document.getElementById("toggle-stats-btn");let ue=!0;ae.onclick=function(){ue=!ue,re.style.display=ue?"":"none",se.style.display=ue?"":"none",ae.textContent=ue?"隐藏统计信息":"显示统计信息"};const me=document.querySelector(".content-right"),ge=document.getElementById("toggle-wordlist-btn");let pe=!0;ge.onclick=function(){pe=!pe,me.style.display=pe?"":"none",ge.textContent=pe?"隐藏单词区":"显示单词区"};const we=document.getElementById("date-color-input"),ye=document.getElementById("date-text-color-input"),fe=document.getElementById("border-radius-display"),he=document.getElementById("border-radius-decrease"),ve=document.getElementById("border-radius-increase");let Ee="#1976d2",be="#ffffff",Be=10;function xe(){Ee=we.value,be=ye.value;document.querySelector(".book-icon").setAttribute("style",`background: ${Ee} !important; color: ${be} !important; min-width: 70px; min-height: 70px; width: auto; height: auto; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: ${Be}px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08); user-select: none; font-weight: bold; padding: 8px; font-size: unset; -webkit-print-color-adjust: exact; print-color-adjust: exact; position: relative;`)}function Ie(){fe.textContent=Be,xe()}he.addEventListener("click",(function(){Be>0&&(Be--,Ie())})),ve.addEventListener("click",(function(){Be<50&&(Be++,Ie())})),we.addEventListener("input",xe),ye.addEventListener("input",xe),window.textJustifyEnabled=!0;let Ce=new Date,Le=Ce.getMonth()+1+"月",Se=Ce.getDate()+"日";const ke=document.querySelector(".book-icon .month"),$e=document.querySelector(".book-icon .day"),ze=document.getElementById("month-input"),Me=document.getElementById("day-input");function Fe(){ke.textContent=Le,$e.textContent=Se}function Ae(){Le=ze.value||"上方",ze.style.display="none",Fe()}function Te(){Se=Me.value||"下方",Me.style.display="none",Fe()}function We(){const e=(document.getElementById("text-input").value.match(/\b[a-zA-Z\-']+\b/g)||[]).length;document.getElementById("total-words").textContent=e;const t=document.getElementById("words-input").value.split("\n").map((e=>e.trim())).filter(Boolean);document.getElementById("total-keywords").textContent=t.length}Fe(),ke.addEventListener("click",(function(){ze.value=Le,ze.style.display="block",ze.focus(),ze.select()})),$e.addEventListener("click",(function(){Me.value=Se,Me.style.display="block",Me.focus(),Me.select()})),ze.addEventListener("blur",Ae),ze.addEventListener("keydown",(function(e){"Enter"===e.key&&Ae()})),Me.addEventListener("blur",Te),Me.addEventListener("keydown",(function(e){"Enter"===e.key&&Te()})),a.addEventListener("input",We),y.addEventListener("input",We),We();const qe=document.getElementById("special-case-bg-color"),je=document.getElementById("special-case-text-color"),Oe=document.getElementById("special-case-border-color"),He=document.getElementById("special-case-border-opacity"),Re=document.getElementById("special-case-border-opacity-value"),De=document.getElementById("reset-special-case-bg-btn"),Ve=document.getElementById("reset-special-case-text-btn");document.getElementById("apply-special-case-style");const Ne={bgColor:"#ffebee",textColor:"#d32f2f",borderColor:"#d32f2f",borderOpacity:.3};let Je={bgColor:Ne.bgColor,textColor:Ne.textColor,borderColor:Ne.borderColor,borderOpacity:Ne.borderOpacity};function Pe(){let e=document.getElementById("special-case-custom-styles");e||(e=document.createElement("style"),e.id="special-case-custom-styles",document.head.appendChild(e));const t=(n=Je.borderColor,o=Je.borderOpacity,n=n.replace("#",""),`rgba(${parseInt(n.substring(0,2),16)}, ${parseInt(n.substring(2,4),16)}, ${parseInt(n.substring(4,6),16)}, ${o})`);var n,o;e.textContent=`\n            .word-row.special-case {\n              background: ${Je.bgColor} !important;\n              border: 1px solid ${t} !important;\n            }\n            .word-row.special-case .word-en {\n              color: ${Je.textColor} !important;\n            }\n            @media print {\n              .word-row.special-case {\n                background: ${Je.bgColor} !important;\n                border: 1px solid ${t} !important;\n                -webkit-print-color-adjust: exact;\n                print-color-adjust: exact;\n              }\n              .word-row.special-case .word-en {\n                color: ${Je.textColor} !important;\n                -webkit-print-color-adjust: exact;\n                print-color-adjust: exact;\n              }\n            }\n          `,localStorage.setItem("special-case-styles",JSON.stringify(Je))}qe.addEventListener("input",(function(){Je.bgColor=this.value,Pe()})),je.addEventListener("input",(function(){Je.textColor=this.value,Pe()})),Oe.addEventListener("input",(function(){Je.borderColor=this.value,Pe()})),He.addEventListener("input",(function(){Je.borderOpacity=parseFloat(this.value),Re.textContent=this.value,Pe()})),De.addEventListener("click",(function(){qe.value=Ne.bgColor,Je.bgColor=Ne.bgColor,Pe()})),Ve.addEventListener("click",(function(){je.value=Ne.textColor,Je.textColor=Ne.textColor,Pe()})),function(){try{const e=localStorage.getItem("special-case-styles");if(e){const t=JSON.parse(e);Je={...Ne,...t},qe.value=Je.bgColor,je.value=Je.textColor,Oe.value=Je.borderColor,He.value=Je.borderOpacity,Re.textContent=Je.borderOpacity,Pe()}}catch(e){console.error("加载特殊容器样式失败",e)}}(),window.indentEnabled=!0,window.indentSize=2;const Ze=document.getElementById("indent-display"),Ue=document.getElementById("indent-decrease"),Ge=document.getElementById("indent-increase"),Xe=document.getElementById("toggle-indent-btn");function _e(){Ze.textContent=window.indentSize,w(),H.dispatchEvent(new Event("input"))}function Ye(){Xe.textContent=window.indentEnabled?"关闭缩进":"开启缩进",w(),H.dispatchEvent(new Event("input"))}function Ke(){const e=d.querySelector("img");return e?e.src:""}function Qe(e){if("string"==typeof e.mainTitle&&(P.value=e.mainTitle),"string"==typeof e.subTitle&&(Z.value=e.subTitle),"string"==typeof e.imageBase64&&function(e){if(d.innerHTML="",e){const t=document.createElement("img");t.src=e,t.style.maxWidth="100%",t.style.height="auto",t.style.display="block",t.style.margin="16px 0",t.style.boxShadow="0 2px 8px rgba(0,0,0,0.06)",t.style.borderRadius="12px",d.appendChild(t)}}(e.imageBase64),"string"==typeof e.words&&(y.value=e.words),"string"==typeof e.text&&(a.value=e.text),"string"==typeof e.translation&&(H.value=e.translation),"string"==typeof e.fontFamily&&(h.value=e.fontFamily),"number"==typeof e.fontSize&&(B=e.fontSize),"number"==typeof e.wordFontSize&&(N=e.wordFontSize),x(),J(),"string"==typeof e.articlePhonetic&&(document.getElementById("article-phonetic-input").value=e.articlePhonetic),document.getElementById("article-phonetic-input").dispatchEvent(new Event("input")),"string"==typeof e.articleMeaning&&(document.getElementById("article-meaning-input").value=e.articleMeaning),document.getElementById("article-meaning-input").dispatchEvent(new Event("input")),P.dispatchEvent(new Event("input")),Z.dispatchEvent(new Event("input")),y.dispatchEvent(new Event("input")),a.dispatchEvent(new Event("input")),H.dispatchEvent(new Event("input")),h.dispatchEvent(new Event("change")),"number"==typeof e.letterSpacing&&(S=e.letterSpacing,k()),"number"==typeof e.wordGap&&(F=e.wordGap,A()),"number"==typeof e.meaningFontSize&&(window.currentMeaningFontSize=e.meaningFontSize,jt()),"string"==typeof e.meaningColor&&(window.currentMeaningColor=e.meaningColor,Ot.value=e.meaningColor,w()),"number"==typeof e.wordMarginVertical&&(j=e.wordMarginVertical,T.textContent=j,localStorage.setItem("word-margin-vertical",j),w()),"boolean"==typeof e.phoneticVisible&&(Dt=e.phoneticVisible,Nt()),"boolean"==typeof e.meaningVisible&&(Vt=e.meaningVisible,Jt()),"boolean"==typeof e.textJustifyEnabled&&(window.textJustifyEnabled=e.textJustifyEnabled,w()),"boolean"==typeof e.indentEnabled&&(window.indentEnabled=e.indentEnabled,Ye()),"number"==typeof e.indentSize&&(window.indentSize=e.indentSize,_e()),"string"==typeof e.monthText&&(Le=e.monthText),"string"==typeof e.dayText&&(Se=e.dayText),Fe(),"string"==typeof e.dateIconColor&&(Ee=e.dateIconColor,we.value=Ee),"string"==typeof e.dateTextColor&&(be=e.dateTextColor,ye.value=be),"number"==typeof e.borderRadius&&(Be=e.borderRadius,fe.textContent=Be),xe(),Array.isArray(e.images)?window.images=e.images:window.images=[],e.videoData&&e.videoData.src){const t=document.createElement("div");t.className="video-container",t.style.width="100%",t.style.margin="16px 0";const n=document.createElement("video");n.id="main-video",n.src=e.videoData.src,n.controls=!0,n.style.width="100%",n.style.borderRadius="12px",n.style.boxShadow="0 2px 8px rgba(0,0,0,0.06)",n.addEventListener("timeupdate",handleVideoTimeUpdate),n.addEventListener("play",(function(){document.querySelectorAll(".tts-underline").forEach((e=>e.classList.remove("tts-underline")))})),t.appendChild(n),d.innerHTML="",d.appendChild(t),window.videoLoaded=!0,"number"==typeof e.videoData.currentTime&&(n.currentTime=e.videoData.currentTime)}if(Array.isArray(e.subtitles)&&e.subtitles.length>0&&(window.subtitles=e.subtitles,window.currentSubtitleIndex=-1),e.phoneticSettings&&("string"==typeof e.phoneticSettings.wrapperStyle&&(window.phoneticWrapperStyle=e.phoneticSettings.wrapperStyle,document.getElementById("phonetic-wrapper-style").value=window.phoneticWrapperStyle),"string"==typeof e.phoneticSettings.color&&(window.phoneticColor=e.phoneticSettings.color,document.getElementById("phonetic-color-input").value=window.phoneticColor),"string"==typeof e.phoneticSettings.fontFamily&&(window.phoneticFontFamily=e.phoneticSettings.fontFamily,document.getElementById("phonetic-font-family").value=window.phoneticFontFamily),"number"==typeof e.phoneticSettings.size&&(window.phoneticSize=e.phoneticSettings.size,document.getElementById("phonetic-size-display").textContent=window.phoneticSize.toFixed(2)),"boolean"==typeof e.phoneticSettings.italic)){window.phoneticItalic=e.phoneticSettings.italic;const t=document.getElementById("phonetic-italic-toggle");t.textContent=window.phoneticItalic?"关闭倾斜":"开启倾斜",t.style.background=window.phoneticItalic?"#1976d2":"#e0e0e0",t.style.color=window.phoneticItalic?"#fff":"#333"}w()}function et(){const e=document.getElementById("main-video");return e?{src:e.src,currentTime:e.currentTime||0}:null}Ue.addEventListener("click",(function(){window.indentSize>.5&&(window.indentSize-=.5,_e())})),Ge.addEventListener("click",(function(){window.indentSize<5&&(window.indentSize+=.5,_e())})),Xe.addEventListener("click",(function(){window.indentEnabled=!window.indentEnabled,Ye()})),document.getElementById("export-config").addEventListener("click",(function(){const e={mainTitle:P.value,subTitle:Z.value,imageBase64:Ke(),text:a.value,translation:H.value,words:y.value,fontFamily:h.value,fontSize:B,wordFontSize:N,articlePhonetic:document.getElementById("article-phonetic-input").value,articleMeaning:document.getElementById("article-meaning-input").value,letterSpacing:S,wordGap:F,meaningFontSize:window.currentMeaningFontSize,meaningColor:window.currentMeaningColor,wordMarginVertical:j,phoneticVisible:Dt,meaningVisible:Vt,textJustifyEnabled:window.textJustifyEnabled,indentEnabled:window.indentEnabled,indentSize:window.indentSize,monthText:Le,dayText:Se,dateIconColor:Ee,dateTextColor:be,borderRadius:Be,images:window.images,coloredWords:window.coloredWords,bgColoredWords:window.bgColoredWords,bgOpacity:window.bgOpacity,customColors:[document.getElementById("custom-color-1").value,document.getElementById("custom-color-2").value,document.getElementById("custom-color-3").value],customBgColors:[document.getElementById("custom-bg-color-1").value,document.getElementById("custom-bg-color-2").value,document.getElementById("custom-bg-color-3").value],phoneticSettings:{wrapperStyle:window.phoneticWrapperStyle,color:window.phoneticColor,fontFamily:window.phoneticFontFamily,size:window.phoneticSize,italic:window.phoneticItalic},videoData:et(),subtitles:window.subtitles||[]},t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json"}),o=document.createElement("a");o.href=URL.createObjectURL(n);let i=P.value.trim()||"配置";i=i.replace(/[\\/:*?"<>|]/g,"_"),o.download=i+".json",document.body.appendChild(o),o.click(),document.body.removeChild(o)})),document.getElementById("import-config-btn").addEventListener("click",(function(){document.getElementById("import-config-file").click()})),document.getElementById("import-config-file").addEventListener("change",(function(e){const t=e.target.files[0];if(!t)return;const n=new FileReader;n.onload=function(e){try{Qe(JSON.parse(e.target.result))}catch(e){console.error("导入失败，文件格式错误！"+e)}},n.readAsText(t),e.target.value=""}));const tt=document.getElementById("import-config-btn");tt.addEventListener("dragover",(function(e){e.preventDefault(),tt.style.border="2px dashed #388e3c",tt.style.background="#e8f5e9"})),tt.addEventListener("dragleave",(function(e){e.preventDefault(),tt.style.border="",tt.style.background=""})),tt.addEventListener("drop",(function(e){e.preventDefault(),tt.style.border="",tt.style.background="";const t=e.dataTransfer.files;if(t.length&&"application/json"===t[0].type){const e=t[0],n=new FileReader;n.onload=function(e){try{Qe(JSON.parse(e.target.result))}catch(e){console.error("导入失败，文件格式错误！"+e)}},n.readAsText(e)}else alert("请拖入JSON格式的配置文件")})),document.getElementById("export-pdf").addEventListener("click",(function(){e.classList.add("hide"),n.classList.add("config-hidden");var t=document.title,o=P.value.trim()||"导出PDF";document.title=o,setTimeout((function(){window.print(),setTimeout((function(){document.title=t}),1e3)}),300)}));const nt=document.getElementById("about-btn"),ot=document.getElementById("about-modal"),it=document.getElementById("close-about-modal");nt.addEventListener("click",(function(){ot.style.display="flex"})),it.addEventListener("click",(function(){ot.style.display="none"})),ot.addEventListener("click",(function(e){e.target===ot&&(ot.style.display="none")}));const ct=document.getElementById("one-paste-input");ct.addEventListener("input",(function(){const e=ct.value,t=e.match(/主标题[:：]\s*(.+)/),n=e.match(/副标题[:：]\s*(.+)/),o=e.match(/重点单词[:：][\r\n]+([\s\S]*?)英文文章[:：]/),i=e.match(/英文文章[:：][\r\n]+([\s\S]*?)中文译文[:：]/),c=e.match(/中文译文[:：][\r\n]+([\s\S]*)/);t&&(P.value=t[1].trim()),n&&(Z.value=n[1].trim()),o&&(y.value=o[1].trim()),i&&(a.value=i[1].trim()),c&&(H.value=c[1].trim()),P.dispatchEvent(new Event("input")),Z.dispatchEvent(new Event("input")),y.dispatchEvent(new Event("input")),a.dispatchEvent(new Event("input")),H.dispatchEvent(new Event("input"))}));const lt=document.getElementById("show-hint-btn"),dt=document.getElementById("hint-modal"),rt=document.getElementById("close-hint-modal"),st=document.getElementById("copy-hint-btn"),at=document.getElementById("hint-content");lt.addEventListener("click",(function(){dt.style.display="flex"})),rt.addEventListener("click",(function(){dt.style.display="none"})),dt.addEventListener("click",(function(e){e.target===dt&&(dt.style.display="none")})),st.addEventListener("click",(function(){if(navigator.clipboard)navigator.clipboard.writeText(at.textContent).then((function(){st.textContent="已复制",setTimeout((function(){st.textContent="复制"}),1200)}),(function(){alert("复制失败，请手动复制")}));else{const e=document.createRange();e.selectNodeContents(at);const t=window.getSelection();t.removeAllRanges(),t.addRange(e);try{document.execCommand("copy"),st.textContent="已复制",setTimeout((function(){st.textContent="复制"}),1200)}catch(e){alert("复制失败，请手动复制")}t.removeAllRanges()}}));document.getElementById("tts-player");const ut=document.getElementById("tts-toggle-btn"),mt=document.getElementById("tts-prev-btn"),gt=document.getElementById("tts-next-btn"),pt=document.getElementById("tts-progress"),wt=document.getElementById("tts-progress-label"),yt=document.getElementById("tts-voice-select"),ft=document.getElementById("tts-rate"),ht=document.getElementById("tts-rate-label");document.getElementById("tts-current-sentence");let vt=[],Et=0,bt=[],Bt=!1,xt=null,It=!1;const Ct=document.createElement("style");Ct.innerHTML=".article-word-container.tts-underline .article-word-en { text-decoration: underline #1976d2 3px; text-underline-offset: 10px; background: #ffe066 !important; border-radius: 0 !important; }\n.tts-underline { text-decoration: none; background: none !important; border-radius: 0 !important; }",document.head.appendChild(Ct);let Lt=0,St=-1;function kt(){ut.textContent=Bt?"暂停朗读":"开始朗读"}function $t(e){return e.match(/[^.!?]+[.!?]?/g)?.map((e=>e.trim())).filter(Boolean)||[]}function zt(){let e=window.speechSynthesis.getVoices();if(0===e.length)return void setTimeout(zt,200);It=!0,bt=e.filter((e=>e.lang.startsWith("en"))),yt.innerHTML="",bt.forEach(((e,t)=>{const n=document.createElement("option");n.value=t,n.textContent=`${e.name} (${e.lang})`,yt.appendChild(n)}));let t=bt.findIndex((e=>e.name.toLowerCase().includes("google")));-1===t&&(t=0),bt[yt.value]||(yt.value=t)}function Mt(){pt.max=vt.length-1,pt.value=Et,wt.textContent=`${Et+1}/${vt.length}`}function Ft(){if(Et>=vt.length)return Bt=!1,void kt();const e=vt[Et];if(!e)return;xt=new SpeechSynthesisUtterance(e);let t=parseInt(yt.value);!isNaN(t)&&bt[t]||(t=0),xt.voice=bt[t],xt.rate=parseFloat(ft.value),(isNaN(xt.rate)||xt.rate<.5||xt.rate>2)&&(xt.rate=1),xt.volume=1,console.log("voice:",xt.voice,"rate:",xt.rate,"text:",e),Lt=-1,xt.onboundary=function(t){if("word"===t.name||void 0!==t.charIndex){const n=/[a-zA-Z\-']+|[^\w\s]+|\s+/g;let o,i=0,c=-1,l=t.charIndex,d=0;for(;null!==(o=n.exec(e));)if(i=o.index+o[0].length,/^[a-zA-Z\-']+$/.test(o[0])){if(i>l){c=d;break}d++}-1===c&&(c=d-1),St=c,document.querySelectorAll(".tts-underline").forEach((e=>e.classList.remove("tts-underline")));const r=Pt[Et]||0;for(let e=0;e<=St;e++){const t=document.getElementById("article-word-"+(r+e));t&&t.classList.add("tts-underline")}}},xt.onend=function(){document.querySelectorAll(".tts-underline").forEach((e=>e.classList.remove("tts-underline"))),St=-1,Bt&&(Et++,Mt(),Et<vt.length?Ft():(Bt=!1,kt()))},window.speechSynthesis.speak(xt)}function At(){vt=$t(a.value.trim()),Et=0,Mt(),function(){const e=localStorage.getItem("tts-rate");e?(ft.value=e,ht.textContent=parseFloat(e).toFixed(2)):(ft.value=1,ht.textContent="1.00")}(),zt(),kt()}ut.onclick=function(){It?vt.length&&(Bt?(Bt=!1,window.speechSynthesis.cancel(),kt()):(window.speechSynthesis.cancel(),Bt=!0,kt(),Ft())):alert("语音包尚未加载，请稍后再试或刷新页面。")},mt.onclick=function(){Et>0&&(Et--,Mt(),Bt&&(window.speechSynthesis.cancel(),setTimeout((()=>{Ft()}),200)))},gt.onclick=function(){Et<vt.length-1&&(Et++,Mt(),Bt&&(window.speechSynthesis.cancel(),setTimeout((()=>{Ft()}),200)))},pt.oninput=function(){Et=parseInt(pt.value),Mt(),Bt&&(window.speechSynthesis.cancel(),setTimeout((()=>{Ft()}),200))},yt.onchange=function(){localStorage.setItem("tts-voice",yt.value),Bt&&(window.speechSynthesis.cancel(),setTimeout((()=>{Ft()}),200))},ft.oninput=function(){ht.textContent=parseFloat(ft.value).toFixed(2),localStorage.setItem("tts-rate",ft.value),Bt&&(window.speechSynthesis.cancel(),setTimeout((()=>{Ft()}),200))},a.addEventListener("input",(function(){vt=$t(a.value.trim()),Et=0,Mt(),Zt()})),"undefined"!=typeof speechSynthesis&&(void 0!==speechSynthesis.onvoiceschanged&&(speechSynthesis.onvoiceschanged=zt),At()),window.addEventListener("DOMContentLoaded",(function(){At()}));document.getElementById("article-phonetic-input").addEventListener("input",(function(){w()}));document.getElementById("article-meaning-input").addEventListener("input",(function(){w()}));const Tt=document.getElementById("meaning-font-size-display"),Wt=document.getElementById("meaning-font-size-increase"),qt=document.getElementById("meaning-font-size-decrease");window.currentMeaningFontSize=16;function jt(){Tt.textContent=window.currentMeaningFontSize,w()}jt(),Wt.addEventListener("click",(function(){window.currentMeaningFontSize<36&&(window.currentMeaningFontSize++,jt())})),qt.addEventListener("click",(function(){window.currentMeaningFontSize>10&&(window.currentMeaningFontSize--,jt())}));const Ot=document.getElementById("meaning-color-input");window.currentMeaningColor=Ot.value,Ot.addEventListener("input",(function(){window.currentMeaningColor=Ot.value,w()}));const Ht=document.getElementById("toggle-phonetic-btn"),Rt=document.getElementById("toggle-meaning-btn");let Dt=!1,Vt=!1;function Nt(){Dt?(document.body.classList.remove("hide-phonetic"),Ht.textContent="隐藏音标"):(document.body.classList.add("hide-phonetic"),Ht.textContent="显示音标")}function Jt(){Vt?(document.body.classList.remove("hide-meaning"),Rt.textContent="隐藏中文"):(document.body.classList.add("hide-meaning"),Rt.textContent="显示中文")}Ht.addEventListener("click",(function(){Dt=!Dt,Nt()})),Rt.addEventListener("click",(function(){Vt=!Vt,Jt()})),Nt(),Jt();let Pt=[];function Zt(){const e=$t(a.value.trim());let t=[],n=0;for(let o of e){const e=o.match(/\w+|[^\w\s]+|\s+/g)||[];let i=0;for(let t of e)/^[a-zA-Z\-']+$/.test(t)&&i++;t.push(n),n+=i}Pt=t}a.addEventListener("input",Zt),Zt();document.getElementById("clear-image-btn").addEventListener("click",(function(){d.innerHTML=""}));const Ut=document.getElementById("content-resizer"),Gt=document.querySelector(".content-left"),Xt=document.querySelector(".reading-content");let _t=!1,Yt=0,Kt=0;const Qt=Ut.offsetWidth;Ut.addEventListener("mousedown",(function(e){_t=!0,Yt=e.clientX,Kt=Gt.getBoundingClientRect().width,Ut.classList.add("active"),document.body.style.cursor="ew-resize",document.body.style.userSelect="none"})),document.addEventListener("mousemove",(function(e){if(!_t)return;const t=Xt.clientWidth;let n=e.clientX-Yt,o=Kt+n;o<120&&(o=120),o>t-120-Qt&&(o=t-120-Qt),Gt.style.flex="none",Gt.style.width=o+"px",me.style.flex="none",me.style.width=t-o-Qt+"px"})),document.addEventListener("mouseup",(function(){_t&&(_t=!1,Ut.classList.remove("active"),document.body.style.cursor="",document.body.style.userSelect="")}));const en=document.getElementById("toggle-word-phonetic-btn");let tn=!0;function nn(){tn?(document.body.classList.remove("hide-word-phonetic"),en.textContent="隐藏重点单词音标"):(document.body.classList.add("hide-word-phonetic"),en.textContent="显示重点单词音标")}en.addEventListener("click",(function(){tn=!tn,nn()})),nn(),window.images=window.images||[],window.insertImageAt=function(e,t){let n=document.createElement("input");n.type="file",n.accept="image/*",n.onchange=function(n){let o=n.target.files[0];if(!o)return;let i=new FileReader;i.onload=function(n){window.images.push({base64:n.target.result,paragraph:e,before:t}),w()},i.readAsDataURL(o)},n.click()},window.renderImagesAt=function(e,t){return(window.images||[]).map(((e,t)=>({...e,idx:t}))).filter((n=>n.paragraph===e&&n.before===t)).map((n=>{const o=`resizable-img-${e}-${t}-${n.idx}`;return setTimeout((()=>{const e=document.getElementById(o);e&&!e.dataset.resizable&&(Cn(e),e.dataset.resizable="1")}),0),`<div id="${o}" class="resizable-image-container" style="margin:8px 0;">\n                <img src="${n.base64}" class="resizable-image" style="width:100%;border-radius:8px;display:block;">\n                <div class="resize-handle"></div>\n                ${window.editImageMode?`<button type="button" onclick="removeImage(${n.idx})" style="margin:4px 0;">删除</button>`:""}\n              </div>`})).join("")},window.removeImage=function(e){window.images.splice(e,1),w()};const on=document.createElement("button");on.id="toggle-edit-image-mode",on.type="button",on.style="background:#1976d2;color:#fff;margin-bottom:8px;",on.textContent="编辑图片模式：关闭",e.insertBefore(on,e.firstChild),window.editImageMode=!1;const cn=document.getElementById("toggle-edit-image-mode");function ln(){cn.textContent="编辑图片模式："+(window.editImageMode?"开启":"关闭")}cn.onclick=function(){window.editImageMode=!window.editImageMode,ln(),w()},ln(),window.showInsertImageMenu=void 0;t.classList.add("visible"),window.colorBrushEnabled=!1,window.currentBrushColor="#1976d2",window.coloredWords={};const dn=document.getElementById("toggle-color-brush-btn"),rn=document.getElementById("clear-all-colors-btn"),sn=document.querySelectorAll(".color-option");function an(){if(dn.textContent=window.colorBrushEnabled?"关闭染色模式":"启用染色模式",dn.style.background=window.colorBrushEnabled?"#d32f2f":"#1976d2",window.colorBrushEnabled){const e=window.currentBrushColor.substring(1);document.body.style.cursor=`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'><path fill='%23${e}' d='M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3zm13.71-9.37l-1.34-1.34c-.39-.39-1.02-.39-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41z'/></svg>") 0 24, auto`}else document.body.style.cursor=""}sn.forEach((e=>{e.addEventListener("click",(function(){if(sn.forEach((e=>e.classList.remove("selected"))),this.classList.add("selected"),window.currentBrushColor=this.dataset.color,window.colorBrushEnabled){const e=window.currentBrushColor.substring(1);document.body.style.cursor=`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'><path fill='%23${e}' d='M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3zm13.71-9.37l-1.34-1.34c-.39-.39-1.02-.39-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41z'/></svg>") 0 24, auto`}}))}));const un=[document.getElementById("custom-color-1"),document.getElementById("custom-color-2"),document.getElementById("custom-color-3")],mn=document.querySelectorAll(".custom-color-option");un.forEach(((e,t)=>{const n=localStorage.getItem(`custom-color-${t+1}`);if(n){e.value=n;const o=document.querySelector(`.custom-color-option[data-custom-id="${t+1}"]`);o&&(o.style.background=n,o.dataset.color=n)}e.addEventListener("input",(function(){const e=document.querySelector(`.custom-color-option[data-custom-id="${t+1}"]`);if(e){const n=this.value;if(e.style.background=n,e.dataset.color=n,e.classList.contains("selected")&&(window.currentBrushColor=n,window.colorBrushEnabled)){const e=n.substring(1);document.body.style.cursor=`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'><path fill='%23${e}' d='M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3zm13.71-9.37l-1.34-1.34c-.39-.39-1.02-.39-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41z'/></svg>") 0 24, auto`}localStorage.setItem(`custom-color-${t+1}`,n)}}))})),mn.forEach((e=>{e.addEventListener("click",(function(){if(sn.forEach((e=>e.classList.remove("selected"))),mn.forEach((e=>e.classList.remove("selected"))),this.classList.add("selected"),window.currentBrushColor=this.dataset.color,window.colorBrushEnabled){const e=window.currentBrushColor.substring(1);document.body.style.cursor=`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'><path fill='%23${e}' d='M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3zm13.71-9.37l-1.34-1.34c-.39-.39-1.02-.39-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41z'/></svg>") 0 24, auto`}}))})),dn.addEventListener("click",(function(){window.colorBrushEnabled=!window.colorBrushEnabled,an()})),rn.addEventListener("click",(function(){window.coloredWords={},document.querySelectorAll(".article-word-container").forEach((e=>{const t=e.querySelector(".article-word-en");t&&(t.style.color="",t.style.textShadow="")}))}));const gn=w;w=function(){gn(),document.querySelectorAll(".article-word-container").forEach((e=>{if(e.classList.contains("article-word-punctuation"))return;const t=e.id,n=e.querySelector(".article-word-en");t&&window.coloredWords[t]&&(n.style.color=window.coloredWords[t],n.style.textShadow="0 0 1px rgba(0,0,0,0.2)"),e.removeEventListener("click",e.colorClickHandler),e.removeEventListener("mouseenter",e.colorMouseEnterHandler),e.removeEventListener("mouseleave",e.colorMouseLeaveHandler),e.colorClickHandler=function(e){window.colorBrushEnabled&&n&&(n.style.color=window.currentBrushColor,n.style.textShadow="0 0 1px rgba(0,0,0,0.2)",t&&(window.coloredWords[t]=window.currentBrushColor),e.stopPropagation())},e.colorMouseEnterHandler=function(){window.colorBrushEnabled&&(this.classList.add("color-brush-hover"),this.style.cursor="pointer")},e.colorMouseLeaveHandler=function(){window.colorBrushEnabled&&this.classList.remove("color-brush-hover")},e.addEventListener("click",e.colorClickHandler),e.addEventListener("mouseenter",e.colorMouseEnterHandler),e.addEventListener("mouseleave",e.colorMouseLeaveHandler)}))};document.getElementById("export-config").onclick;document.getElementById("export-config").onclick=function(){const e={mainTitle:P.value,subTitle:Z.value,imageBase64:Ke(),text:a.value,translation:H.value,words:y.value,fontFamily:h.value,fontSize:B,wordFontSize:N,articlePhonetic:document.getElementById("article-phonetic-input").value,articleMeaning:document.getElementById("article-meaning-input").value,letterSpacing:S,wordGap:F,meaningFontSize:window.currentMeaningFontSize,meaningColor:window.currentMeaningColor,wordMarginVertical:j,phoneticVisible:Dt,meaningVisible:Vt,textJustifyEnabled:window.textJustifyEnabled,images:window.images,coloredWords:window.coloredWords,customColors:[document.getElementById("custom-color-1").value,document.getElementById("custom-color-2").value,document.getElementById("custom-color-3").value]},t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json"}),o=document.createElement("a");o.href=URL.createObjectURL(n);let i=P.value.trim()||"配置";i=i.replace(/[\\/:*?"<>|]/g,"_"),o.download=i+".json",document.body.appendChild(o),o.click(),document.body.removeChild(o)};const pn=Qe;Qe=function(e){if(pn(e),e.coloredWords&&(window.coloredWords=e.coloredWords,w()),e.customColors&&Array.isArray(e.customColors)&&e.customColors.length>=3)for(let t=0;t<3;t++){const n=e.customColors[t];if(n&&"string"==typeof n){const e=document.getElementById(`custom-color-${t+1}`),o=document.querySelector(`.custom-color-option[data-custom-id="${t+1}"]`);e&&o&&(e.value=n,o.style.background=n,o.dataset.color=n,localStorage.setItem(`custom-color-${t+1}`,n))}}},un.forEach(((e,t)=>{const n=localStorage.getItem(`custom-color-${t+1}`);if(n){e.value=n;const o=document.querySelector(`.custom-color-option[data-custom-id="${t+1}"]`);o&&(o.style.background=n,o.dataset.color=n)}})),sn.length>0&&(sn.forEach((e=>e.classList.remove("selected"))),mn.forEach((e=>e.classList.remove("selected"))),sn[0].classList.add("selected"),window.currentBrushColor=sn[0].dataset.color),an(),Object.keys(window.coloredWords).length>0&&w(),window.bgColorBrushEnabled=!1,window.currentBgColor="#ffe066",window.bgOpacity=.8,window.bgColoredWords={};const wn=document.getElementById("toggle-bg-color-brush-btn"),yn=document.getElementById("clear-all-bg-colors-btn"),fn=document.querySelectorAll(".bg-color-option"),hn=document.getElementById("bg-opacity-slider"),vn=document.getElementById("bg-opacity-value");function En(){if(wn.textContent=window.bgColorBrushEnabled?"关闭背景染色":"启用背景染色",wn.style.background=window.bgColorBrushEnabled?"#d32f2f":"#1976d2",window.bgColorBrushEnabled){const e=window.currentBgColor.substring(1);document.body.style.cursor=`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'><path fill='%23${e}' d='M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z'/></svg>") 0 24, auto`}else window.colorBrushEnabled||(document.body.style.cursor="")}fn.forEach((e=>{e.addEventListener("click",(function(){if(fn.forEach((e=>e.classList.remove("selected"))),this.classList.add("selected"),window.currentBgColor=this.dataset.color,window.bgColorBrushEnabled){const e=window.currentBgColor.substring(1);document.body.style.cursor=`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'><path fill='%23${e}' d='M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z'/></svg>") 0 24, auto`}}))}));const bn=[document.getElementById("custom-bg-color-1"),document.getElementById("custom-bg-color-2"),document.getElementById("custom-bg-color-3")],Bn=document.querySelectorAll(".custom-bg-color-option");bn.forEach(((e,t)=>{const n=localStorage.getItem(`custom-bg-color-${t+1}`);if(n){e.value=n;const o=document.querySelector(`.custom-bg-color-option[data-custom-id="${t+1}"]`);o&&(o.style.background=n,o.dataset.color=n)}e.addEventListener("input",(function(){const e=document.querySelector(`.custom-bg-color-option[data-custom-id="${t+1}"]`);if(e){const n=this.value;if(e.style.background=n,e.dataset.color=n,e.classList.contains("selected")&&(window.currentBgColor=n,window.bgColorBrushEnabled)){const e=n.substring(1);document.body.style.cursor=`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'><path fill='%23${e}' d='M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z'/></svg>") 0 24, auto`}localStorage.setItem(`custom-bg-color-${t+1}`,n)}}))})),Bn.forEach((e=>{e.addEventListener("click",(function(){if(fn.forEach((e=>e.classList.remove("selected"))),Bn.forEach((e=>e.classList.remove("selected"))),this.classList.add("selected"),window.currentBgColor=this.dataset.color,window.bgColorBrushEnabled){const e=window.currentBgColor.substring(1);document.body.style.cursor=`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'><path fill='%23${e}' d='M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z'/></svg>") 0 24, auto`}}))})),wn.addEventListener("click",(function(){window.bgColorBrushEnabled=!window.bgColorBrushEnabled,En()})),yn.addEventListener("click",(function(){window.bgColoredWords={},document.querySelectorAll(".article-word-container").forEach((e=>{const t=e.querySelector(".article-word-en");t&&(t.style.background="",t.style.opacity=""),e.classList.remove("bg-colored")}))}));const xn=w;w=function(){xn(),document.querySelectorAll(".article-word-container").forEach((e=>{if(e.classList.contains("article-word-punctuation"))return;const t=e.id,n=e.querySelector(".article-word-en");if(t&&window.bgColoredWords[t]){const o=window.bgColoredWords[t];n.style.background=o.color,n.style.opacity=o.opacity,e.classList.add("bg-colored")}e.removeEventListener("click",e.bgColorClickHandler),e.bgColorClickHandler=function(o){window.bgColorBrushEnabled&&n&&(t&&window.bgColoredWords[t]&&window.bgColoredWords[t].color===window.currentBgColor&&window.bgColoredWords[t].opacity===window.bgOpacity?(delete window.bgColoredWords[t],n.style.background="",n.style.opacity="",e.classList.remove("bg-colored")):(n.style.background=window.currentBgColor,n.style.opacity=window.bgOpacity,e.classList.add("bg-colored"),t&&(window.bgColoredWords[t]={color:window.currentBgColor,opacity:window.bgOpacity})),o.stopPropagation())},e.addEventListener("click",e.bgColorClickHandler)}))};document.getElementById("export-config").onclick;document.getElementById("export-config").onclick=function(){const e={mainTitle:P.value,subTitle:Z.value,imageBase64:Ke(),text:a.value,translation:H.value,words:y.value,fontFamily:h.value,fontSize:B,wordFontSize:N,articlePhonetic:document.getElementById("article-phonetic-input").value,articleMeaning:document.getElementById("article-meaning-input").value,letterSpacing:S,wordGap:F,meaningFontSize:window.currentMeaningFontSize,meaningColor:window.currentMeaningColor,wordMarginVertical:j,phoneticVisible:Dt,meaningVisible:Vt,textJustifyEnabled:window.textJustifyEnabled,images:window.images,coloredWords:window.coloredWords,bgColoredWords:window.bgColoredWords,bgOpacity:window.bgOpacity,customColors:[document.getElementById("custom-color-1").value,document.getElementById("custom-color-2").value,document.getElementById("custom-color-3").value],customBgColors:[document.getElementById("custom-bg-color-1").value,document.getElementById("custom-bg-color-2").value,document.getElementById("custom-bg-color-3").value]},t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json"}),o=document.createElement("a");o.href=URL.createObjectURL(n);let i=P.value.trim()||"配置";i=i.replace(/[\\/:*?"<>|]/g,"_"),o.download=i+".json",document.body.appendChild(o),o.click(),document.body.removeChild(o)};const In=Qe;Qe=function(e){if(In(e),e.bgColoredWords&&(window.bgColoredWords=e.bgColoredWords),"number"==typeof e.bgOpacity&&(window.bgOpacity=e.bgOpacity,hn.value=e.bgOpacity,vn.textContent=e.bgOpacity.toFixed(1)),e.customBgColors&&Array.isArray(e.customBgColors)&&e.customBgColors.length>=3)for(let t=0;t<3;t++){const n=e.customBgColors[t];if(n&&"string"==typeof n){const e=document.getElementById(`custom-bg-color-${t+1}`),o=document.querySelector(`.custom-bg-color-option[data-custom-id="${t+1}"]`);e&&o&&(e.value=n,o.style.background=n,o.dataset.color=n,localStorage.setItem(`custom-bg-color-${t+1}`,n))}}w()},bn.forEach(((e,t)=>{const n=localStorage.getItem(`custom-bg-color-${t+1}`);if(n){e.value=n;const o=document.querySelector(`.custom-bg-color-option[data-custom-id="${t+1}"]`);o&&(o.style.background=n,o.dataset.color=n)}})),fn.length>0&&(fn.forEach((e=>e.classList.remove("selected"))),Bn.forEach((e=>e.classList.remove("selected"))),fn[0].classList.add("selected"),window.currentBgColor=fn[0].dataset.color),En(),Object.keys(window.bgColoredWords||{}).length>0&&w();document.getElementById("video-upload-area"),document.getElementById("video-input"),document.getElementById("clear-video-btn"),document.getElementById("subtitle-upload-area"),document.getElementById("subtitle-input"),document.getElementById("clear-subtitle-btn");function Cn(e){const t=e.querySelector("img"),n=e.querySelector(".resize-handle");let o,i,c,l,d=!1;function r(e){if(!d)return;const n=c+(e.clientX-o);t.style.width=n+"px",t.style.height="auto"}function s(){d=!1,document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",s)}n.addEventListener("mousedown",(function(e){e.preventDefault(),d=!0,o=e.clientX,i=e.clientY,c=t.offsetWidth,l=t.offsetHeight,document.addEventListener("mousemove",r),document.addEventListener("mouseup",s)}))}function Ln(){!function(){const e=document.getElementById("phonetic-wrapper-style");e.value=window.phoneticWrapperStyle,e.addEventListener("change",(function(){window.phoneticWrapperStyle=e.value,w()}));const t=document.getElementById("phonetic-color-input");t.value=window.phoneticColor;const n=function(e){console.log("开始更新音标颜色为:",e),window.phoneticColor=e,window.updateAllPhoneticStyles(),console.log("音标颜色已更新完成")};t.addEventListener("input",(function(e){const t=e.target.value;console.log("检测到颜色变化:",t),n(t)})),t.addEventListener("change",(function(e){const t=e.target.value;console.log("检测到颜色变化(change):",t),n(t)})),t.addEventListener("click",(function(){console.log("颜色选择器被点击")}));const o=document.getElementById("phonetic-font-family");o.value=window.phoneticFontFamily,o.addEventListener("change",(function(){window.phoneticFontFamily=o.value,window.updateAllPhoneticStyles(),w()}));const i=document.getElementById("phonetic-size-display"),c=document.getElementById("phonetic-size-decrease");function l(){i.textContent=window.phoneticSize.toFixed(2),window.updateAllPhoneticStyles(),w()}document.getElementById("phonetic-size-increase").addEventListener("click",(function(){window.phoneticSize<2&&(window.phoneticSize=Math.round(100*(window.phoneticSize+.05))/100,l())})),c.addEventListener("click",(function(){window.phoneticSize>.5&&(window.phoneticSize=Math.round(100*(window.phoneticSize-.05))/100,l())}));const d=document.getElementById("phonetic-italic-toggle");function r(){d.textContent=window.phoneticItalic?"关闭倾斜":"开启倾斜",d.style.background=window.phoneticItalic?"#1976d2":"#e0e0e0",d.style.color=window.phoneticItalic?"#fff":"#333",window.updateAllPhoneticStyles(),w()}d.addEventListener("click",(function(){window.phoneticItalic=!window.phoneticItalic,r()})),l(),r();const s=document.getElementById("refresh-phonetic-styles");s&&s.addEventListener("click",(function(){console.log("手动刷新音标样式"),window.updateAllPhoneticStyles(),w()}))}(),setTimeout((function(){console.log("延迟执行音标样式更新"),window.updateAllPhoneticStyles()}),500)}window.subtitles=[],window.currentSubtitleIndex=-1,window.videoLoaded=!1,window.phoneticWrapperStyle="brackets",window.phoneticColor="#8a8a8a",window.phoneticFontFamily="'Times New Roman', Times, serif",window.phoneticSize=.85,window.phoneticItalic=!1,window.updateAllPhoneticStyles=function(){console.log("正在更新所有音标样式，颜色:",window.phoneticColor);const e=document.querySelectorAll(".article-word-phonetic");console.log("找到音标元素数量:",e.length),e.forEach((e=>{e.setAttribute("style",`\n              font-size: ${window.phoneticSize}em !important;\n              color: ${window.phoneticColor} !important;\n              font-family: ${window.phoneticFontFamily} !important;\n              font-style: ${window.phoneticItalic?"italic":"normal"} !important;\n              height: 1.2em;\n            `)}))},"complete"===document.readyState||"interactive"===document.readyState?Ln():document.addEventListener("DOMContentLoaded",Ln)}))</script>
<div id=activation-modal style=display:none;position:fixed;z-index:9999;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,.25);align-items:center;justify-content:center>
<div style="background:#fff;padding:32px 32px 24px 32px;border-radius:16px;box-shadow:0 4px 24px rgba(0,0,0,.18);min-width:320px;max-width:90vw;position:relative;display:flex;flex-direction:column;align-items:center">
<div style=font-size:1.3em;font-weight:700;margin-bottom:12px>
请输入激活码。没有激活码请联系作者获取,微信suixinyinyue
</div>
<input id=activation-code-input style=width:220px;height:36px;font-size:1.1em;margin-bottom:16px placeholder=激活码>
<div id=device-id-area style=font-size:.98em;color:#1976d2;margin-bottom:10px;word-break:break-all;user-select:all>
设备码：<span id=device-id-value>加载中...</span>
</div>
<button id=activation-submit-btn style="background:#1976d2;color:#fff;border:none;border-radius:6px;padding:8px 24px;font-size:1em;cursor:pointer">
激活
</button>
<div id=activation-error style=color:#d32f2f;margin-top:10px;display:none>
激活码错误，请重试
</div>
</div>
</div>
<script>(function(){"use strict";var ERROR="input is invalid type",WINDOW="object"==typeof window,root=WINDOW?window:{};root.JS_SHA256_NO_WINDOW&&(WINDOW=!1);var WEB_WORKER=!WINDOW&&"object"==typeof self,NODE_JS=!root.JS_SHA256_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;NODE_JS?root=global:WEB_WORKER&&(root=self);var COMMON_JS=!root.JS_SHA256_NO_COMMON_JS&&"object"==typeof module&&module.exports,AMD="function"==typeof define&&define.amd,ARRAY_BUFFER=!root.JS_SHA256_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,HEX_CHARS="0123456789abcdef".split(""),EXTRA=[-2147483648,8388608,32768,128],SHIFT=[24,16,8,0],K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],OUTPUT_TYPES=["hex","array","digest","arrayBuffer"],blocks=[];!root.JS_SHA256_NO_NODE_JS&&Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),!ARRAY_BUFFER||!root.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(t){return"object"==typeof t&&t.buffer&&t.buffer.constructor===ArrayBuffer});var createOutputMethod=function(t,h){return function(r){return new Sha256(h,!0).update(r)[t]()}},createMethod=function(t){var h=createOutputMethod("hex",t);NODE_JS&&(h=nodeWrap(h,t)),h.create=function(){return new Sha256(t)},h.update=function(t){return h.create().update(t)};for(var r=0;r<OUTPUT_TYPES.length;++r){var e=OUTPUT_TYPES[r];h[e]=createOutputMethod(e,t)}return h},nodeWrap=function(method,is224){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),algorithm=is224?"sha224":"sha256",nodeMethod=function(t){if("string"==typeof t)return crypto.createHash(algorithm).update(t,"utf8").digest("hex");if(null==t)throw new Error(ERROR);return t.constructor===ArrayBuffer&&(t=new Uint8Array(t)),Array.isArray(t)||ArrayBuffer.isView(t)||t.constructor===Buffer?crypto.createHash(algorithm).update(new Buffer(t)).digest("hex"):method(t)};return nodeMethod},createHmacOutputMethod=function(t,h){return function(r,e){return new HmacSha256(r,h,!0).update(e)[t]()}},createHmacMethod=function(t){var h=createHmacOutputMethod("hex",t);h.create=function(h){return new HmacSha256(h,t)},h.update=function(t,r){return h.create(t).update(r)};for(var r=0;r<OUTPUT_TYPES.length;++r){var e=OUTPUT_TYPES[r];h[e]=createHmacOutputMethod(e,t)}return h};function Sha256(t,h){h?(blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=t}function HmacSha256(t,h,r){var e,s=typeof t;if("string"===s){var i,o=[],a=t.length,H=0;for(e=0;e<a;++e)(i=t.charCodeAt(e))<128?o[H++]=i:i<2048?(o[H++]=192|i>>6,o[H++]=128|63&i):i<55296||i>=57344?(o[H++]=224|i>>12,o[H++]=128|i>>6&63,o[H++]=128|63&i):(i=65536+((1023&i)<<10|1023&t.charCodeAt(++e)),o[H++]=240|i>>18,o[H++]=128|i>>12&63,o[H++]=128|i>>6&63,o[H++]=128|63&i);t=o}else{if("object"!==s)throw new Error(ERROR);if(null===t)throw new Error(ERROR);if(ARRAY_BUFFER&&t.constructor===ArrayBuffer)t=new Uint8Array(t);else if(!(Array.isArray(t)||ARRAY_BUFFER&&ArrayBuffer.isView(t)))throw new Error(ERROR)}t.length>64&&(t=new Sha256(h,!0).update(t).array());var n=[],S=[];for(e=0;e<64;++e){var c=t[e]||0;n[e]=92^c,S[e]=54^c}Sha256.call(this,h,r),this.update(S),this.oKeyPad=n,this.inner=!0,this.sharedMemory=r}Sha256.prototype.update=function(t){if(!this.finalized){var h,r=typeof t;if("string"!==r){if("object"!==r)throw new Error(ERROR);if(null===t)throw new Error(ERROR);if(ARRAY_BUFFER&&t.constructor===ArrayBuffer)t=new Uint8Array(t);else if(!(Array.isArray(t)||ARRAY_BUFFER&&ArrayBuffer.isView(t)))throw new Error(ERROR);h=!0}for(var e,s,i=0,o=t.length,a=this.blocks;i<o;){if(this.hashed&&(this.hashed=!1,a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),h)for(s=this.start;i<o&&s<64;++i)a[s>>2]|=t[i]<<SHIFT[3&s++];else for(s=this.start;i<o&&s<64;++i)(e=t.charCodeAt(i))<128?a[s>>2]|=e<<SHIFT[3&s++]:e<2048?(a[s>>2]|=(192|e>>6)<<SHIFT[3&s++],a[s>>2]|=(128|63&e)<<SHIFT[3&s++]):e<55296||e>=57344?(a[s>>2]|=(224|e>>12)<<SHIFT[3&s++],a[s>>2]|=(128|e>>6&63)<<SHIFT[3&s++],a[s>>2]|=(128|63&e)<<SHIFT[3&s++]):(e=65536+((1023&e)<<10|1023&t.charCodeAt(++i)),a[s>>2]|=(240|e>>18)<<SHIFT[3&s++],a[s>>2]|=(128|e>>12&63)<<SHIFT[3&s++],a[s>>2]|=(128|e>>6&63)<<SHIFT[3&s++],a[s>>2]|=(128|63&e)<<SHIFT[3&s++]);this.lastByteIndex=s,this.bytes+=s-this.start,s>=64?(this.block=a[16],this.start=s-64,this.hash(),this.hashed=!0):this.start=s}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Sha256.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var t=this.blocks,h=this.lastByteIndex;t[16]=this.block,t[h>>2]|=EXTRA[3&h],this.block=t[16],h>=56&&(this.hashed||this.hash(),t[0]=this.block,t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0),t[14]=this.hBytes<<3|this.bytes>>>29,t[15]=this.bytes<<3,this.hash()}},Sha256.prototype.hash=function(){var t,h,r,e,s,i,o,a,H,n=this.h0,S=this.h1,c=this.h2,f=this.h3,A=this.h4,R=this.h5,u=this.h6,_=this.h7,E=this.blocks;for(t=16;t<64;++t)h=((s=E[t-15])>>>7|s<<25)^(s>>>18|s<<14)^s>>>3,r=((s=E[t-2])>>>17|s<<15)^(s>>>19|s<<13)^s>>>10,E[t]=E[t-16]+h+E[t-7]+r<<0;for(H=S&c,t=0;t<64;t+=4)this.first?(this.is224?(i=300032,_=(s=E[0]-1413257819)-150054599<<0,f=s+24177077<<0):(i=704751109,_=(s=E[0]-210244248)-1521486534<<0,f=s+143694565<<0),this.first=!1):(h=(n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10),e=(i=n&S)^n&c^H,_=f+(s=_+(r=(A>>>6|A<<26)^(A>>>11|A<<21)^(A>>>25|A<<7))+(A&R^~A&u)+K[t]+E[t])<<0,f=s+(h+e)<<0),h=(f>>>2|f<<30)^(f>>>13|f<<19)^(f>>>22|f<<10),e=(o=f&n)^f&S^i,u=c+(s=u+(r=(_>>>6|_<<26)^(_>>>11|_<<21)^(_>>>25|_<<7))+(_&A^~_&R)+K[t+1]+E[t+1])<<0,h=((c=s+(h+e)<<0)>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),e=(a=c&f)^c&n^o,R=S+(s=R+(r=(u>>>6|u<<26)^(u>>>11|u<<21)^(u>>>25|u<<7))+(u&_^~u&A)+K[t+2]+E[t+2])<<0,h=((S=s+(h+e)<<0)>>>2|S<<30)^(S>>>13|S<<19)^(S>>>22|S<<10),e=(H=S&c)^S&f^a,A=n+(s=A+(r=(R>>>6|R<<26)^(R>>>11|R<<21)^(R>>>25|R<<7))+(R&u^~R&_)+K[t+3]+E[t+3])<<0,n=s+(h+e)<<0;this.h0=this.h0+n<<0,this.h1=this.h1+S<<0,this.h2=this.h2+c<<0,this.h3=this.h3+f<<0,this.h4=this.h4+A<<0,this.h5=this.h5+R<<0,this.h6=this.h6+u<<0,this.h7=this.h7+_<<0},Sha256.prototype.hex=function(){this.finalize();var t=this.h0,h=this.h1,r=this.h2,e=this.h3,s=this.h4,i=this.h5,o=this.h6,a=this.h7,H=HEX_CHARS[t>>28&15]+HEX_CHARS[t>>24&15]+HEX_CHARS[t>>20&15]+HEX_CHARS[t>>16&15]+HEX_CHARS[t>>12&15]+HEX_CHARS[t>>8&15]+HEX_CHARS[t>>4&15]+HEX_CHARS[15&t]+HEX_CHARS[h>>28&15]+HEX_CHARS[h>>24&15]+HEX_CHARS[h>>20&15]+HEX_CHARS[h>>16&15]+HEX_CHARS[h>>12&15]+HEX_CHARS[h>>8&15]+HEX_CHARS[h>>4&15]+HEX_CHARS[15&h]+HEX_CHARS[r>>28&15]+HEX_CHARS[r>>24&15]+HEX_CHARS[r>>20&15]+HEX_CHARS[r>>16&15]+HEX_CHARS[r>>12&15]+HEX_CHARS[r>>8&15]+HEX_CHARS[r>>4&15]+HEX_CHARS[15&r]+HEX_CHARS[e>>28&15]+HEX_CHARS[e>>24&15]+HEX_CHARS[e>>20&15]+HEX_CHARS[e>>16&15]+HEX_CHARS[e>>12&15]+HEX_CHARS[e>>8&15]+HEX_CHARS[e>>4&15]+HEX_CHARS[15&e]+HEX_CHARS[s>>28&15]+HEX_CHARS[s>>24&15]+HEX_CHARS[s>>20&15]+HEX_CHARS[s>>16&15]+HEX_CHARS[s>>12&15]+HEX_CHARS[s>>8&15]+HEX_CHARS[s>>4&15]+HEX_CHARS[15&s]+HEX_CHARS[i>>28&15]+HEX_CHARS[i>>24&15]+HEX_CHARS[i>>20&15]+HEX_CHARS[i>>16&15]+HEX_CHARS[i>>12&15]+HEX_CHARS[i>>8&15]+HEX_CHARS[i>>4&15]+HEX_CHARS[15&i]+HEX_CHARS[o>>28&15]+HEX_CHARS[o>>24&15]+HEX_CHARS[o>>20&15]+HEX_CHARS[o>>16&15]+HEX_CHARS[o>>12&15]+HEX_CHARS[o>>8&15]+HEX_CHARS[o>>4&15]+HEX_CHARS[15&o];return this.is224||(H+=HEX_CHARS[a>>28&15]+HEX_CHARS[a>>24&15]+HEX_CHARS[a>>20&15]+HEX_CHARS[a>>16&15]+HEX_CHARS[a>>12&15]+HEX_CHARS[a>>8&15]+HEX_CHARS[a>>4&15]+HEX_CHARS[15&a]),H},Sha256.prototype.toString=Sha256.prototype.hex,Sha256.prototype.digest=function(){this.finalize();var t=this.h0,h=this.h1,r=this.h2,e=this.h3,s=this.h4,i=this.h5,o=this.h6,a=this.h7,H=[t>>24&255,t>>16&255,t>>8&255,255&t,h>>24&255,h>>16&255,h>>8&255,255&h,r>>24&255,r>>16&255,r>>8&255,255&r,e>>24&255,e>>16&255,e>>8&255,255&e,s>>24&255,s>>16&255,s>>8&255,255&s,i>>24&255,i>>16&255,i>>8&255,255&i,o>>24&255,o>>16&255,o>>8&255,255&o];return this.is224||H.push(a>>24&255,a>>16&255,a>>8&255,255&a),H},Sha256.prototype.array=Sha256.prototype.digest,Sha256.prototype.arrayBuffer=function(){this.finalize();var t=new ArrayBuffer(this.is224?28:32),h=new DataView(t);return h.setUint32(0,this.h0),h.setUint32(4,this.h1),h.setUint32(8,this.h2),h.setUint32(12,this.h3),h.setUint32(16,this.h4),h.setUint32(20,this.h5),h.setUint32(24,this.h6),this.is224||h.setUint32(28,this.h7),t},HmacSha256.prototype=new Sha256,HmacSha256.prototype.finalize=function(){if(Sha256.prototype.finalize.call(this),this.inner){this.inner=!1;var t=this.array();Sha256.call(this,this.is224,this.sharedMemory),this.update(this.oKeyPad),this.update(t),Sha256.prototype.finalize.call(this)}};var exports=createMethod();exports.sha256=exports,exports.sha224=createMethod(!0),exports.sha256.hmac=createHmacMethod(),exports.sha224.hmac=createHmacMethod(!0),COMMON_JS?module.exports=exports:(root.sha256=exports.sha256,root.sha224=exports.sha224,AMD&&define((function(){return exports})))})()</script>
<script>function getCodeHash(t){return sha256("ENGLISHTOOL2024"+t).toUpperCase().slice(0,6)}function checkActivated(){return"1"===localStorage.getItem("Please cultivate your own products deeply")}function showActivationModal(){document.getElementById("activation-modal").style.display="flex"}function hideActivationModal(){document.getElementById("activation-modal").style.display="none"}function tryActivate(){document.getElementById("activation-code-input").value.trim().toUpperCase()===getCodeHash(localStorage.getItem("paiBanUid"))?(localStorage.setItem("Please cultivate your own products deeply","1"),hideActivationModal(),location.reload()):document.getElementById("activation-error").style.display="block"}window.addEventListener("DOMContentLoaded",(function(){checkActivated()||showActivationModal(),document.getElementById("activation-submit-btn").onclick=tryActivate,document.getElementById("activation-code-input").onkeydown=function(t){"Enter"===t.key&&tryActivate()}}))</script>
<script>async function getDeviceUniqueId(){const e=[window.screen.width,window.screen.height,window.screen.availWidth,window.screen.availHeight,window.screen.colorDepth,navigator.deviceMemory||"unknown",navigator.hardwareConcurrency||"unknown",navigator.maxTouchPoints||"unknown"];let n="";if(navigator.getBattery)try{const e=await navigator.getBattery();n=`${e.level}-${e.charging}`}catch(e){n="unknown"}else n="unsupported";e.push(n);const t=e.join("|");return sha256(t).slice(0,6).toUpperCase()}getDeviceUniqueId().then((e=>{console.log("设备编码:",e);var n=document.getElementById("device-id-value");n&&(n.textContent=e),localStorage.setItem("paiBanUid",e)}))</script>
<script>function makeImageResizable(e){const t=e.querySelector("img"),n=e.querySelector(".resize-handle");let o,i,u,c,s=!1;n.addEventListener("mousedown",(function(e){e.preventDefault(),s=!0,o=e.clientX,i=e.clientY,u=t.offsetWidth,c=t.offsetHeight,document.body.style.userSelect="none"})),document.addEventListener("mousemove",(function(e){if(!s)return;const n=e.clientX-o;e.clientY;let i=u+n;i<40&&(i=40),t.style.width=i+"px",t.style.height="auto"})),document.addEventListener("mouseup",(function(){s&&(s=!1,document.body.style.userSelect="")}))}</script>
<script>document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("a4-area"),t=document.getElementById("a4-bg-color-input"),n=document.getElementById("reset-bg-color-btn");t.addEventListener("input",(function(){const n=t.value;var a;e.style.backgroundColor=n,e.style.backgroundImage="",a=n,localStorage.setItem("a4-bg-color",a)})),n.addEventListener("click",(function(){e.style.backgroundColor="#ffffff",t.value="#ffffff",localStorage.removeItem("a4-bg-color")}));const a=document.querySelectorAll(".stripe-pattern-btn");let r={pattern:"none",gap:10,width:10,angle:45,color:"#f5f5f5",opacity:1,style:"solid"};function i(t){r.pattern=t;let n="";const a=function(e,t){e=e.replace("#","");const n=parseInt(e.substring(0,2),16),a=parseInt(e.substring(2,4),16),r=parseInt(e.substring(4,6),16);return`rgba(${n}, ${a}, ${r}, ${t})`}(r.color,r.opacity),i=r.gap+r.width;switch(t){case"horizontal":n=`repeating-linear-gradient(0deg, ${a}, ${a} ${r.width}px, transparent ${r.width}px, transparent ${i}px)`;break;case"vertical":n=`repeating-linear-gradient(90deg, ${a}, ${a} ${r.width}px, transparent ${r.width}px, transparent ${i}px)`;break;case"diagonal":n=`repeating-linear-gradient(${r.angle}deg, ${a}, ${a} ${r.width}px, transparent ${r.width}px, transparent ${i}px)`;break;case"diagonal-reverse":n=`repeating-linear-gradient(${-r.angle}deg, ${a}, ${a} ${r.width}px, transparent ${r.width}px, transparent ${i}px)`;break;case"cross":n=`repeating-linear-gradient(0deg, transparent, transparent ${i-r.width}px, ${a} ${i-r.width}px, ${a} ${i}px), \n                         repeating-linear-gradient(90deg, transparent, transparent ${i-r.width}px, ${a} ${i-r.width}px, ${a} ${i}px)`;break;case"diagonal-cross":n=`repeating-linear-gradient(${r.angle}deg, transparent, transparent ${i-r.width}px, ${a} ${i-r.width}px, ${a} ${i}px), \n                         repeating-linear-gradient(${-r.angle}deg, transparent, transparent ${i-r.width}px, ${a} ${i-r.width}px, ${a} ${i}px)`;break;case"zigzag":const t=2*i;n=`linear-gradient(${r.angle}deg, ${a} 25%, transparent 25%) 0 0, \n                         linear-gradient(${-r.angle}deg, ${a} 25%, transparent 25%) 0 0, \n                         linear-gradient(${r.angle}deg, transparent 75%, ${a} 75%) 0 0, \n                         linear-gradient(${-r.angle}deg, transparent 75%, ${a} 75%) 0 0`,e.style.backgroundSize=`${t}px ${t}px`;break;default:n="",e.style.backgroundSize=""}n?(e.style.backgroundImage=n,"zigzag"!==t&&"solid"!==r.style&&(e.style.backgroundSize="","dashed"===r.style?e.style.backgroundSize=`${3*r.width}px ${3*r.width}px`:"dotted"===r.style&&(e.style.backgroundSize=`${2*r.width}px ${2*r.width}px`,"horizontal"!==t&&"vertical"!==t||(e.style.backgroundImage=`radial-gradient(${a} ${r.width/2}px, transparent ${r.width/2}px)`)))):(e.style.backgroundImage="",e.style.backgroundSize=""),localStorage.setItem("a4-stripe-settings",JSON.stringify(r))}a.forEach((function(e){e.addEventListener("click",(function(){i(e.getAttribute("data-pattern"))}))}));const o=document.getElementById("stripe-gap-decrease"),d=document.getElementById("stripe-gap-increase"),s=document.getElementById("stripe-gap-display");o.addEventListener("click",(function(){r.gap>1&&(r.gap--,s.textContent=r.gap,"none"!==r.pattern&&i(r.pattern))})),d.addEventListener("click",(function(){r.gap<50&&(r.gap++,s.textContent=r.gap,"none"!==r.pattern&&i(r.pattern))}));const c=document.getElementById("stripe-width-decrease"),l=document.getElementById("stripe-width-increase"),g=document.getElementById("stripe-width-display");c.addEventListener("click",(function(){r.width>1&&(r.width--,g.textContent=r.width,"none"!==r.pattern&&i(r.pattern))})),l.addEventListener("click",(function(){r.width<50&&(r.width++,g.textContent=r.width,"none"!==r.pattern&&i(r.pattern))}));const p=document.getElementById("stripe-angle-decrease"),u=document.getElementById("stripe-angle-increase"),m=document.getElementById("stripe-angle-display");p.addEventListener("click",(function(){r.angle>0&&(r.angle=(r.angle-5)%360,r.angle<0&&(r.angle+=360),m.textContent=r.angle,"none"!==r.pattern&&i(r.pattern))})),u.addEventListener("click",(function(){r.angle=(r.angle+5)%360,m.textContent=r.angle,"none"!==r.pattern&&i(r.pattern)}));const y=document.getElementById("stripe-color-input");y.addEventListener("input",(function(){r.color=y.value,"none"!==r.pattern&&i(r.pattern)}));const $=document.getElementById("stripe-opacity-slider"),b=document.getElementById("stripe-opacity-value");$.addEventListener("input",(function(){r.opacity=parseFloat($.value),b.textContent=r.opacity.toFixed(1),"none"!==r.pattern&&i(r.pattern)}));const f=document.getElementById("stripe-style-select");f.addEventListener("change",(function(){r.style=f.value,"none"!==r.pattern&&i(r.pattern)}));document.getElementById("apply-custom-stripe-btn").addEventListener("click",(function(){"none"!==r.pattern?i(r.pattern):i("horizontal")}));const E=document.getElementById("upload-bg-image-btn"),I=document.getElementById("remove-bg-image-btn"),h=document.getElementById("bg-image-input"),k=document.getElementById("bg-size-select"),v=document.getElementById("bg-position-select"),x=document.getElementById("bg-repeat-select"),w=document.getElementById("apply-bg-settings-btn");let B={size:"cover",position:"center",repeat:"no-repeat"};function z(){localStorage.setItem("a4-bg-image-settings",JSON.stringify(B))}E.addEventListener("click",(function(){h.click()})),h.addEventListener("change",(function(){const t=h.files[0];if(t&&t.type.startsWith("image/")){const n=new FileReader;n.onload=function(t){const n=t.target.result;e.style.backgroundImage=`url(${n})`,e.style.backgroundSize=B.size,e.style.backgroundPosition=B.position,e.style.backgroundRepeat=B.repeat,function(e){localStorage.setItem("a4-bg-image",e)}(n)},n.readAsDataURL(t)}})),I.addEventListener("click",(function(){e.style.backgroundImage="",localStorage.removeItem("a4-bg-image")})),k.addEventListener("change",(function(){B.size=k.value,e.style.backgroundSize=B.size,z()})),v.addEventListener("change",(function(){B.position=v.value,e.style.backgroundPosition=B.position,z()})),x.addEventListener("change",(function(){B.repeat=x.value,e.style.backgroundRepeat=B.repeat,z()})),w.addEventListener("click",(function(){e.style.backgroundSize=B.size,e.style.backgroundPosition=B.position,e.style.backgroundRepeat=B.repeat,z()})),function(){const n=localStorage.getItem("a4-bg-color");n&&(e.style.backgroundColor=n,t.value=n)}(),function(){const e=localStorage.getItem("a4-stripe-settings");if(e)try{r=JSON.parse(e),document.getElementById("stripe-gap-display").textContent=r.gap,document.getElementById("stripe-width-display").textContent=r.width,document.getElementById("stripe-angle-display").textContent=r.angle,document.getElementById("stripe-color-input").value=r.color,document.getElementById("stripe-opacity-slider").value=r.opacity,document.getElementById("stripe-opacity-value").textContent=r.opacity.toFixed(1),document.getElementById("stripe-style-select").value=r.style,"none"!==r.pattern&&i(r.pattern)}catch(e){console.error("加载条纹设置失败",e)}}(),function(){const t=localStorage.getItem("a4-bg-image");t&&(e.style.backgroundImage=`url(${t})`,function(){const t=localStorage.getItem("a4-bg-image-settings");if(t)try{B=JSON.parse(t),k.value=B.size||"cover",v.value=B.position||"center",x.value=B.repeat||"no-repeat",e.style.backgroundSize=B.size,e.style.backgroundPosition=B.position,e.style.backgroundRepeat=B.repeat}catch(e){console.error("加载背景图片设置失败",e)}}())}()}))</script>
</body>
</html>