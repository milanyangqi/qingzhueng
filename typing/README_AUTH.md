# 打字练习系统认证说明

## 概述

本打字练习系统现在已经集成了与主项目的单点登录（SSO）功能。用户必须先登录主项目后才能访问打字练习系统。

## 认证流程

1. **初始访问检查**：当用户访问打字练习系统时，系统会自动检查用户是否已在主项目中登录
2. **自动重定向**：如果用户未登录，系统会自动重定向到主项目登录页面
3. **路由守卫**：每次路由跳转时都会验证登录状态
4. **定期检查**：系统每5分钟自动检查一次登录状态，如果登录过期会提示用户重新登录

## 技术实现

### 认证工具函数 (`src/utils/auth.ts`)

- `checkLoginStatus()`: 检查用户登录状态
- `authGuard()`: 基础认证守卫，返回登录状态但不重定向
- `strictAuthGuard()`: 严格认证守卫，未登录时自动重定向
- `redirectToMainProject()`: 重定向到主项目
- `startAuthCheck()`: 启动定期认证检查

### 路由守卫 (`src/router.ts`)

全局路由守卫确保每次路由跳转时都验证用户登录状态。

### 应用启动检查 (`src/main.ts`)

应用启动前会先检查登录状态，只有已登录用户才能看到应用界面。

## 配置说明

### CORS配置

主项目后端已配置CORS，允许打字练习系统访问认证API：

```python
CORS(app, supports_credentials=True, origins=[
    'http://localhost:3000', 
    'http://127.0.0.1:3000', 
    'http://localhost:5173',  # Vite开发服务器
    'http://127.0.0.1:5173'
])
```

### API端点

- `GET /api/check_login`: 检查用户登录状态
  - 返回: `{"logged_in": boolean, "user_id": number|null}`

## 使用方法

1. **启动主项目后端**：
   ```bash
   cd backend
   python app.py
   ```

2. **启动打字练习系统**：
   ```bash
   cd typing
   pnpm install
   pnpm dev
   ```

3. **访问流程**：
   - 首先访问主项目 `http://localhost:5000` 并登录
   - 然后访问打字练习系统 `http://localhost:3000`
   - 系统会自动验证登录状态并允许访问

## 安全特性

- **Cookie认证**：使用HTTP Cookie进行会话管理
- **跨域安全**：严格的CORS配置确保安全性
- **自动过期检查**：定期检查登录状态，防止过期会话
- **路由保护**：所有路由都受到认证保护

## 故障排除

1. **无法访问认证API**：
   - 检查主项目后端是否正常运行
   - 确认CORS配置是否正确
   - 检查网络连接

2. **登录状态检查失败**：
   - 清除浏览器Cookie
   - 重新登录主项目
   - 检查浏览器控制台错误信息

3. **频繁重定向**：
   - 检查主项目会话配置
   - 确认Cookie设置正确